angular.module("WDWeb").controller("uploadCtrl",["$scope","$rootScope","$route","$routeParams","$timeout","$log","$window","$localStorage","$location","uploader","wdService","leftNavService","fileListUI",function(f,d,e,l,t,a,u,c,p,o,n,r,s){u.navigator.userAgent;var v=p.search().query,F=p.search();this.toogle=!1,this.fieldPanel=!1,f.cabinetList=[],f.fieldTableSpin=!0,f.softpopFlag=2,this.slider=!0,d.leftMenuAction=3,f.saveSelected="0",f.openCats=!1,f.radioData=[],f.openCustom=!1,f.showPgFields={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},f.listOfTags=[],f.tagValues=[],f.host=c.host,d.pageTitle="Save to Worldox",d.host=c.host,f.fileError=!1,f.chkVer,f.textValue="",window.onresize=function(){$("#leftSaveAs").dxScrollView("instance").option("height",window.innerHeight-225)},f.checkDesc={validationRules:[{type:"required",message:"Description is required."}]},f.setDescValue=function(e){console.log(e)},f.wdFilterBox={placeholder:"Filter",elementAttr:{id:"wdFilterSave"},onEnterKey:function(e){f.fieldTableSpin=!1,f.textValue=e.event.target.value,"ft"==f.prefillData?f.listTable(!1,!0):t(function(){f.fieldTableSpin=!0},1e3)},showClearButton:!0},f.wdFilterSideBtn={icon:"ms-Icon ms-Icon--Accept",onClick:function(e){f.fieldTableSpin=!1;var i=$("#wdFilterSave").dxTextBox("instance");f.textValue=i.option("value"),"ft"==f.prefillData?f.listTable(!1,!0):t(function(){f.fieldTableSpin=!0},1e3)},elementAttr:{class:"wdFilterSideBtn"}},f.init=function(){n.chksession().then(function(e){""!=e.data.user&&e.data.user||(c.$reset(),p.path("/login"),p.url(p.path())),f.setCategoryList("")},function(e){a.log(e)}),f.tabNav=p.url(),f.uploadData={Cabinets:"",Description:"",Security:"",Type:"1",SaveAs:"",Comments:""},F.desc&&(f.uploadData.Description=p.search().desc.split(".")[0]),f.fileFlag=!1,f.btnTxt="Save",f.accept="*",f.value=[],f.uploadMode="instantly",f.toggle=!1,f.fieldPanel=!1,f.isLoginValid=!0,f.loginValidationError={},this.fieldListData=[],this.selectedTab="QuickProfiles",this.listOptions=[],f.uploadInc=!0,f.saveType="0",f.prefillData="qp",f.searchMode="contains",f.uploadTitle="QuickProfile",f.selectedField=0,f.setAnchor=function(e){if($("#wdFilterSave").dxTextBox("instance").option("value",""),f.textValue="","qp"==e)return f.selected=f.quickProfile[0],!1;f.selected=f.favMatters[0]},t(function(){angular.element(document).ready(function(){for(var e=document.querySelectorAll(".fieldSpinner"),i=0;i<e.length;i++)new fabric.Spinner(e[i])})},0),""!=v?n.fileList(v,1,100).then(function(e){var i=e.data.root;if(""!=i.Header.ErrorCount)f.saveType="2";else if("1"==i.items.length){f.fileMeta=i.items[0];var l,t="";t=null==i.items[0].Version?1:parseInt(f.fileMeta.Version),""==F.wdVer||F.wdVer==t?f.chkVer=!0:f.chkVer=!1,l="#"+(t+1),f.saveType="1",f.saveSelected="2",f.radioData=[{text:"New version "+l,value:2113,visible:f.chkVer},{text:"Replace original",value:72},{text:"New File",value:"0"}],f.checkSaveType()}else f.saveType="2"},function(e){a.log(e)}):f.saveType="2",f.checkSaveType=function(){if("4"==p.search().popupType){var e=void 0!==f.fileMeta.Field1?f.fileMeta.Field1:"",i=void 0!==f.fileMeta.Field2?f.fileMeta.Field2:"",l=void 0!==f.fileMeta.Field3?f.fileMeta.Field3:"",t=void 0!==f.fileMeta.Field4?f.fileMeta.Field4:"",a=void 0!==f.fileMeta.Field5?f.fileMeta.Field5:"",o=void 0!==f.fileMeta.Field6?f.fileMeta.Field6:"",d=void 0!==f.fileMeta.Field7?f.fileMeta.Field7:"",n=void 0!==f.fileMeta.Description?f.fileMeta.Description:"",r=(void 0!==f.fileMeta.Comments&&f.fileMeta.Comments,void 0!==f.fileMeta.Name?f.fileMeta.Name:""),s=c.host+"/cgi-bin/wdwebcgi.exe?SERVE+wd_SID="+c.userData.session+"+html=/api/apiList.json+cabinet="+f.fileMeta.profileGroupId+"+f1="+e+"+f2="+i+"+f3="+l+"+f4="+t+"+f5="+a+"+f6="+o+"+f7="+d+"+desc="+n+"+type="+f.uploadData.Type+"+security="+f.uploadData.Security+"+zms=+loc="+c.uploadLocation+"+domain="+c.host+"+popFlag="+f.softpopFlag+"+name="+r+"+wd_List_ID="+f.fileMeta.LID+"+wd_List_RecNum="+f.fileMeta.RN;u.location.href=s}},n.getQuickProfile().then(function(e){f.quickProfile=e.data.root.QuickProfiles,f.selected=e.data.root.QuickProfiles[0]},function(e){a.error(e)}),n.getFavMatters().then(function(e){f.favMatters=e.data.root.FavMatters},function(e){a.log(e)}),r.iniData(p.search().formats,2).then(function(e){var l=e.data.root;if(""!=l.Header.ErrorCount)return DevExpress.ui.notify(l.Header.wd_Error_MSG+"!","error",4e3),!1;if(""!=l.items||F.ext)if(""==l.items&&F.ext)f.getFileExt();else{for(i=0;i<l.items.length;i++)fileExt.push(l.items[i]);r.iniData(p.search().hook,2).then(function(e){var l=e.data.root;if(""!=l.Header.ErrorCount)return DevExpress.ui.notify(l.Header.wd_Error_MSG+"!","error",4e3),!1;for(i=0;i<l.items.length;i++)if("DefaultExt"==l.items[i].K)return f.uploadData.SaveAs=l.items[i].D,!1},function(e){console.log(e)})}else fileExt.push({D:"",K:"Default (*.rtf)"}),f.uploadData.SaveAs="rtf"},function(e){console.log(e)}),f.setFavMatter=function(e){for(var i=angular.copy(e),l=[],t=1;t<=7;t++)if(e.hasOwnProperty("f"+t+"d")&&""!==e["f"+t+"d"]){var a="<span class='favAlign'><b>"+i["f"+t+"n"]+"</b> "+i["f"+t+"c"]+" "+i["f"+t+"d"]+"</span>";l.push(a)}return l.unshift("<h3>&nbsp;&nbsp;"+i.szPGID.toUpperCase()+"</h3>"),l.join("&nbsp;&nbsp;")},f.wdCommentDesc="",f.editDescComment={height:90,bindingOptions:{value:"wdCommentDesc"},onInitialized:function(e){if(f.fileMeta.Comments)return f.wdCommentDesc=f.fileMeta.Description+"\r\n\r\n"+f.fileMeta.Comments,!1;f.wdCommentDesc=f.fileMeta.Description},onValueChanged:function(e){f.wdCommentDesc=e.value}},f.groupValue=72,f.formContainer={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-90}},f.saveContainer={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},f.scrollLeftNav={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-225}},f.setSaveContainerHeight=function(){return window.innerHeight-225},window.onresize=function(){},f.selectSave={bindingOptions:{dataSource:"radioData",value:"groupValue"},valueExpr:"value",layout:"horizontal",width:"100%",onValueChanged:function(e){f.groupValue=e.value,f.saveSelected=e.value,"0"==e.value?f.btnTxt="Next":f.btnTxt="Save"}},f.saveAs=function(){"0"==f.saveSelected?(f.uploadData.Type="0",f.saveType="2"):(f.fields.field1.value=f.fileMeta.Field1,f.fields.field2.value=f.fileMeta.Field2,f.fields.field3.value=f.fileMeta.Field3,f.fields.field4.value=f.fileMeta.Field4,f.fields.field5.value=f.fileMeta.Field5,f.fields.field6.value=f.fileMeta.Field6,f.fields.field7.value=f.fileMeta.Field7,f.uploadData.Cabinets=f.fileMeta.profileGroupId+"|",f.uploadData.Description=f.fileMeta.Description,f.uploadData.Type=f.saveSelected,f.sendTo())},f.securityOpt={bindingOptions:{formData:"uploadData",readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,colCount:1},items:o.securitySelect()},f.uploadOption={bindingOptions:{formData:"uploadData",readOnly:!1,showColonAfterLabel:!1,showValidationSummary:!1,colCount:1},onFieldDataChanged:function(e){if("Cabinets"===e.dataField&&e.value){var i=e.value.split("|");f.fieldListData=[],"ft"==f.prefillData&&(f.prefillData="qp",f.selectedField="");for(var l=1;l<=7;l++)e.component.itemOption("Field"+[l],"visible",!0),""!=i[l]?(e.component.itemOption("Field"+[l],"visible",!0),f.fields["field"+l].placeholder=i[l]):e.component.itemOption("Field"+[l],"visible",!1);F.ext&&f.getFileExt(),f.fileFlag=!1}},validationGroup:"uploadFile",items:o.uploadFields()},f.getFileExt=function(){fileExt.push({D:"",K:"Default (*"+F.ext+")"}),f.uploadData.SaveAs=F.ext.split(".")[1]},f.sendBtn={text:"Save",type:"success",useSubmitBehavior:!0},f.sendData={bindingOptions:{text:"btnTxt"},type:"success",useSubmitBehavior:!0,onClick:function(e){if("Next"==f.btnTxt){f.fields.field1.value=f.fileMeta.Field1,f.fields.field2.value=f.fileMeta.Field2,f.fields.field3.value=f.fileMeta.Field3,f.fields.field4.value=f.fileMeta.Field4,f.fields.field5.value=f.fileMeta.Field5,f.fields.field6.value=f.fileMeta.Field6,f.fields.field7.value=f.fileMeta.Field7;for(var i=1;i<=7;i++)null==f.fileMeta["Field"+i+"Name"]?(f.fileMeta["Field"+i+"Name"]="",f.fieldDesc["field"+i]=""):f.fieldDesc["field"+i]=f.fileMeta["Field"+i+"Desc"],f.showPgFields["field"+i]=f.fileMeta["Field"+i+"Name"];f.uploadData.Cabinets=f.fileMeta.profileGroupId+"|"+f.fileMeta.Field1Name+"|"+f.fileMeta.Field2Name+"|"+f.fileMeta.Field3Name+"|"+f.fileMeta.Field4Name+"|"+f.fileMeta.Field5Name+"|"+f.fileMeta.Field6Name+"|"+f.fileMeta.Field7Name+"|"}}},f.focusOutField=function(){n.getFieldDesc(f.uploadData.Cabinets,f.fields).then(function(e){f.fieldDesc={field1:e.data.Desc.Field1,field2:e.data.Desc.Field2,field3:e.data.Desc.Field3,field4:e.data.Desc.Field4,field5:e.data.Desc.Field5,field6:e.data.Desc.Field6,field7:e.data.Desc.Field7}},function(e){a.error(e)})},f.fields={field1:{value:"",placeholder:"Field1",onValueChanged:function(e){f.fields.field1.value=e.value}},field2:{value:"",placeholder:"Field2",onValueChanged:function(e){f.fields.field2.value=e.value}},field3:{value:"",placeholder:"Field3",onValueChanged:function(e){f.fields.field3.value=e.value}},field4:{value:"",placeholder:"Field4",onValueChanged:function(e){f.fields.field4.value=e.value}},field5:{value:"",placeholder:"Field5",onValueChanged:function(e){f.fields.field5.value=e.value}},field6:{value:"",placeholder:"Field6",onValueChanged:function(e){f.fields.field6.value=e.value}},field7:{value:"",placeholder:"Field7",onValueChanged:function(e){f.fields.field7.value=e.value}}},f.fieldDesc={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},f.openPanel={icon:"toolbox",onClick:function(e){f.toogle=!0}}},f.$watch("uploadData.Cabinets",function(e,i){if(e==i)return!(f.fileFlag=!0);f.fileFlag=!1}),f.isActive=function(e){return f.selected===e},f.sendTo=function(){f.uploadInc=!1,"0"==f.saveSelected?f.checkMulti():2113!=f.groupValue&&72!=f.groupValue||(f.fileMeta.Description=f.wdCommentDesc,n.deleteFile(f.fileMeta,f.groupValue).then(function(e){var i=e.data;if(""!==i.fileStatus.errorStatus.ErrorCount)return DevExpress.ui.notify(i.fileStatus.errorStatus.wd_Error_MSG+"!","error",4e3),!1;f.longName=i.file.DN,f.redirectfRowser()},function(e){console.log(e)}))},f.redirectfRowser=function(){var e=void 0!==f.fields.field1.value?f.fields.field1.value:"",i=void 0!==f.fields.field2.value?f.fields.field2.value:"",l=void 0!==f.fields.field3.value?f.fields.field3.value:"",t=void 0!==f.fields.field4.value?f.fields.field4.value:"",a=void 0!==f.fields.field5.value?f.fields.field5.value:"",o=void 0!==f.fields.field6.value?f.fields.field6.value:"",d=void 0!==f.fields.field7.value?f.fields.field7.value:"",n=c.host+"/cgi-bin/wdwebcgi.exe?SERVE+wd_SID="+c.userData.session+"+html=/api/apiList.json+cabinet="+f.fileMeta.profileGroupId+"+f1="+e+"+f2="+i+"+f3="+l+"+f4="+t+"+f5="+a+"+f6="+o+"+f7="+d+"+desc="+encodeURIComponent(f.wdCommentDesc)+"+type="+f.groupValue+"+security="+f.uploadData.Security+"+zms=+loc="+c.uploadLocation+"+domain="+c.host+"+popFlag="+f.softpopFlag+"+name="+encodeURIComponent(f.longName)+"+wd_List_ID="+f.fileMeta.LID+"+wd_List_RecNum="+f.fileMeta.RN;u.location.href=n},f.checkMulti=function(){F.multi?n.testProfile(f.uploadData,f.fields).then(function(e){var i=e.data;if(""!=i.Header.ErrorCount)return DevExpress.ui.notify(i.Header.wd_Error_MSG+"!","error",4e3),!1;u.location.href=c.host+"/cgi-bin/wdwebcgi.exe?SERVE+wd_SID="+c.userData.session+"+html=/api/apiList.json+cabinet="+f.uploadData.Cabinets.split("|")[0]+"+f1="+f.fields.field1.value+"+f2="+f.fields.field2.value+"+f3="+f.fields.field3.value+"+f4="+f.fields.field4.value+"+f5="+f.fields.field5.value+"+f6="+f.fields.field6.value+"+f7="+f.fields.field7.value+"+desc="+f.uploadData.Description+"+type="+f.groupValue+"+security="+f.uploadData.Security+"+loc="+c.uploadLocation+"+domain="+c.host+"+popFlag="+f.softpopFlag+"+comment="+f.uploadData.Comments},function(e){DevExpress.ui.notify("IIS Fatal Error!","error",4e3)}):n.newFile(f.fields,f.uploadData).then(function(e){var i=e.data.download,l=i.FileZMS.replace(/\\/g,"\\\\");if(""!=i.errorStatus.ErrorCount)return f.uploadInc=!0,f.fieldDesc={field1:i.FileField1Desc,field2:i.FileField2Desc,field3:i.FileField3Desc,field4:i.FileField4Desc,field5:i.FileField5Desc,field6:i.FileField6Desc,field7:i.FileField7Desc},DevExpress.ui.notify(i.errorStatus.wd_Error_MSG+"!","error",4e3),!1;u.location.href=c.host+"/cgi-bin/wdwebcgi.exe?SERVE+wd_SID="+c.userData.session+"+html=/api/apiList.json+cabinet="+i.Cabinet+"+f1="+i.FileField1+"+f2="+i.FileField2+"+f3="+i.FileField3+"+f4="+i.FileField4+"+f5="+i.FileField5+"+f6="+i.FileField6+"+f7="+i.FileField7+"+desc="+f.uploadData.Description+"+type=0+security="+i.Security+"+zms="+l+"+loc="+i.UploadTo+"+domain="+c.host+"+popFlag="+f.softpopFlag+"+name="+i.Name+"+wd_List_ID="+i.FileLID+"+wd_List_RecNum="+i.FileRN+"+comment="+f.uploadData.Comments},function(e){a.error(e)})},f.getCategoryList=function(e){var i=s.getCategoryList(e),o=[];i.then(function(e){var i=e.data;if(""!=i.root.Header.Error_Count)return DevExpress.ui.notify(i.Header.wd_Error_MSG+"!","error",4e3),!1;f.wholeCatList=i.root,angular.forEach(i.root.Items,function(i,e){i.text=i.CD,i.onClick=function(e){$("#wdTagsList").dxTagBox("option","value").push(i.CD)}});var l=i.root.Items.filter(function(e){return"Personal"==e.TAB_NAME}),t=i.root.Items.filter(function(e){return"Public"==e.TAB_NAME}),a=i.root.Items.filter(function(e){return"Folder"==e.TAB_NAME});0!==l.length&&o.push({text:"Personal",items:l}),0!==t.length&&o.push({text:"Public",items:t}),0!==a.length&&o.push({text:"Folder",items:a}),f.categoryUpload=[{text:"Select a Category",value:0,items:o},{text:"Add/Edit Tags",value:1,onClick:function(e){f.openCats=!0,d.$broadcast("categoryList",{cats:f.wholeCatList,file:!1,type:"saveAs"})}}],f.cancelPanel=function(){f.openCats=!1,f.$broadcast("closeCats",{panelupdate:!1})}},function(e){DevExpress.ui.notify("IIS Fatal Error!","error",4e3)})},f.categoryUpload=[],f.categoryContextualMenu={target:"#categoryMenuBtn",bindingOptions:{items:"categoryUpload"}},f.contexualMenuBtnCat={width:"100px",text:"Categories",onClick:function(){n.testProfile(f.uploadData,f.fields).then(function(e){var i=e.data;if(""!=i.Header.ErrorCount)return DevExpress.ui.notify(i.Header.wd_Error_MSG+"!","error",4e3),!1;f.getCategoryList(i.Profile.wdPath)},function(e){DevExpress.ui.notify("IIS Fatal Error!","error",4e3)}),$("#wdCatMenu").dxContextMenu("toggle",!0)}},f.getTestProfile=function(){n.testProfile(f.uploadData,f.fields).then(function(e){var i=e.data;if(""!=i.Header.ErrorCount)return f.showDetails(i),!1;f.listOfTags=[],f.setCategoryList(i.Profile.wdPath),f.showDetails(i)},function(e){DevExpress.ui.notify("IIS Fatal Error!","error",4e3)})},f.showDetails=function(e){var i=e.Profile.Fields;f.fieldDesc={field1:i.Field1.wd_File_Field_Error,field2:i.Field2.wd_File_Field_Error,field3:i.Field3.wd_File_Field_Error,field4:i.Field4.wd_File_Field_Error,field5:i.Field5.wd_File_Field_Error,field6:i.Field6.wd_File_Field_Error,field7:i.Field7.wd_File_Field_Error};for(var l=1;l<=7;l++)""!==i["Field"+l].wd_File_Field_Error?f["wdFieldColor"+l]="#a80000":f["wdFieldColor"+l]="#107c10",f.fieldDesc["field"+l]=i["Field"+l].wd_File_Field_Desc},f.closePanel=function(e){this.toogle=e,this.fieldPanel=e},f.getUploadData=function(e,i){if(f.fileFlag=!0,f.selected=e,i){for(var l=1;l<=7;l++)if(0==e.hasOwnProperty("f"+[l]+"n")){e["f"+[l]+"n"]=""}for(l=1;l<=7;l++)if(0==e.hasOwnProperty("f"+[l]+"c")){e["f"+[l]+"c"]=""}}f.uploadData.Cabinets=e.dwPGID+"|"+e.f1n+"|"+e.f2n+"|"+e.f3n+"|"+e.f4n+"|"+e.f5n+"|"+e.f6n+"|"+e.f7n+"|";for(l=1;l<=7;l++)f.fields["field"+l].value=e["f"+l+"c"],f.fieldDesc["field"+l]=e["f"+l+"d"];f.fieldDesc={field1:e.f1d,field2:e.f2d,field3:e.f3d,field4:e.f4d,field5:e.f5d,field6:e.f6d,field7:e.f7d}},f.checkTables=function(){var e=f.selectedField;f.getTables(e,f.fields["field"+e].placeholder)},f.getTables=function(e,i){$("#wdFilterSave").dxTextBox("instance").option("value",""),f.fieldListData=[],f.fieldTableSpin=!1,f.selectedField=e,f.maxcount=500,f.indexFr=0,f.prefillData="ft",f.uploadTitle=i,f.fieldPanel=!0,f.listTable(!1,!0)},f.getFieldsDesc=function(e){var i=e.element[0].id.split("fieldDesc")[1],l={field1:f.fields.field1.value,field2:f.fields.field2.value,field3:f.fields.field3.value,field4:f.fields.field4.value,field5:f.fields.field5.value,field6:f.fields.field6.value,field7:f.fields.field7.value};n.getFieldDes(f.uploadData.Cabinets.split("|")[0],l,i).then(function(e){var i=e.data.data.fields;f.fieldDesc={field1:i.field1,field2:i.field2,field3:i.field3,field4:i.field4,field5:i.field5,field6:i.field6,field7:i.field7}},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},f.loadMore={text:"Load More",type:"success",useSubmitBehavior:!1,onClick:function(){f.indexFr=+f.indexFr+(f.maxcount+1),f.listTable(!0,!1)}},f.isArray=function(e){return angular.isArray(e)},f.setField=function(e){for(f.selected=e,i=1;i<=7;i++)e["f"+i+"n"]&&(f.fields["field"+i].value=e["f"+i+"n"],f.fieldDesc["field"+i]=e["f"+i+"d"])},f.cancelPanel=function(){f.openCustom=!1,f.uploadData.Security=" "},f.getToolTip=function(e){var l="";for(i=1;i<=7;i++)e["f"+i+"n"]&&(l+=l=e["f"+i+"n"]+" - "+e["f"+i+"d"]+" | ");return l.substring(0,l.length-2)},f.listTable=function(l,e){n.fieldTables(f.uploadData.Cabinets.split("|")[0],f.fields,f.selectedField,f.maxcount,f.indexFr,e,f.textValue).then(function(e){if(""!=e.data.root.Header.ErrorCount)return DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;if(l){var i=f.fieldListData.concat(e.data.root.FieldTbl);f.fieldListData=i}else f.fieldListData=e.data.root.FieldTbl;f.fieldNum=e.data.root.Header.FieldNum,f.listCount=parseInt(e.data.root.Header.ListCount),f.fieldNumber=f.selectedField,t(function(){f.fieldTableSpin=!0},1e3)},function(e){f.fieldTableSpin=!0,DevExpress.ui.notify("Server Error!","error",4e3),console.log(e)})},f.tags={bindingOptions:{dataSource:"listOfTags",value:"tagValues"},displayExpr:"CD",valueExpr:"CD",itemTemplate:"customTagItem"},f.setCategoryList=function(e){var i=decodeURIComponent(e);s.getCategoryList(i).then(function(e){var i=e.data.root;if(""!==i.Header.Error_Count)return DevExpress.ui.notify(i.Header.Error_Msg,"error",4e3),!1;f.listOfTags=i.Items},function(e){DevExpress.ui.notify("IIS Error","error",4e3)})},f.cabinetList=o.getCabinet(),f.securityList=[{name:"None",value:""},{name:"Hidden",value:"16"},{name:"Protected",value:"8"}],f.saveAsDrop=fileExt,f.changeSecurity=function(e){"18"==e.value&&(f.openCustom=!0)},f.setSelected=function(e){f.selected=e},f.getSaveValue=function(e){return e.K.split("(")[1].split(")")[0].split("*.")[1]},f.selectedCabinet=function(e){for(var i=e.value.split("|"),l=1;l<=7;l++)""!=i[l]?f.showPgFields["field"+l]=i[l]:f.showPgFields["field"+l]="";f.field={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""}},f.showHideDesc=o.getMultData()}]).factory("uploader",function(e,l,t,a){t.checkLocalStorage(),l.getCabinetList().then(function(e){if(""!=e.data.root.Header.ErrorCount)return DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;for(i=0;i<e.data.root.Cabinets.length;i++)cabinetList.push(e.data.root.Cabinets[i])},function(e){console.log(e)});var o=r(),d=[{itemType:"group",items:[{dataField:"Security",editorType:"dxSelectBox",editorOptions:{dataSource:[{name:"None",value:""},{name:"Hidden",value:"H"},{name:"Protected",value:"P"}],valueExpr:"value",displayExpr:"name",width:150}}]}],n=[{itemType:"group",items:[{dataField:"Description",editorOptions:{placeholder:"Description",width:"100%",value:function(){var e="";a.search().desc&&(e=a.search().desc);return e}()},validationRules:[{type:"required"}],width:"100%",visible:o},{dataField:"Comments",editorType:"dxTextArea",editorOptions:{placeholder:"Comments",width:"100%"},validationRules:[{type:"required"}],width:"100%",visible:!o},{dataField:"Cabinets",editorType:"dxSelectBox",editorOptions:{dataSource:cabinetList,valueExpr:"pgFields",displayExpr:"pgName",width:"150px"},validationRules:[{type:"required"}]},{dataField:"Field1",template:"Field1",label:{visible:!1},visible:!1,editorOptions:{width:"150px"}},{dataField:"Field2",template:"Field2",label:{visible:!1},visible:!1,editorOptions:{width:"150px"}},{dataField:"Field3",template:"Field3",label:{visible:!1},visible:!1,editorOptions:{width:"150px"}},{dataField:"Field4",template:"Field4",label:{visible:!1},visible:!1,editorOptions:{width:"150px"}},{dataField:"Field5",template:"Field5",label:{visible:!1},visible:!1,editorOptions:{width:"150px"}},{dataField:"Field6",template:"Field6",label:{visible:!1},visible:!1,editorOptions:{width:"150px"}},{dataField:"Field7",template:"Field7",label:{visible:!1},visible:!1,editorOptions:{width:"150px"}},{dataField:"Security",editorType:"dxSelectBox",editorOptions:{dataSource:[{name:"None",value:""},{name:"Hidden",value:"8"},{name:"Protected",value:"16"}],valueExpr:"value",displayExpr:"name",width:"150px"}},{dataField:"SaveAs",editorType:"dxSelectBox",editorOptions:{dataSource:fileExt,valueExpr:function(e){return e.K.split("(")[1].split(")")[0].split("*.")[1]},displayExpr:"K"},validationRules:[{type:"required"}],visible:o}]}];return{uploadFields:function(){return n},securitySelect:function(){return d},getCabinet:function(){return cabinetList},getMultData:r};function r(){return!a.search().multi}});var cabinetList=[],fileInfo={name:""},fileExt=[];function updateFields(e,i){for(var l=1;l<=7;l++)""!=i[l]?(e.component.itemOption("Field"+[l],"visible",!0),e.component.itemOption("Field"+[l],"editorOptions",{placeholder:i[l]}),e.component.itemOption("Field"+[l],"label",{text:i[l]})):e.component.itemOption("Field"+[l],"visible",!1)}