"use strict";function homeController(l,t,r,n,i,a,o,s,d,e,c,u,p,f){var h,w=i.search();l.fileError=!1,l.$storage=r,l.panelWidth="50%",l.fileErrorMessage=[],l.fileSuccessMessage=[],l.dialogTitle="",l.sethandle="",a.timeStamp="",l.userType="",l.wdattachGroup=0,window.addEventListener("dragover",function(e){e.preventDefault()},!1),window.addEventListener("drop",function(e){e&&e.preventDefault()},!1);var g;n.onbeforeunload=(g=[r.ftListId],angular.forEach(g,function(e,t){void 0!==e&&s.clearListfromParm(e).then(function(e){})}),delete r.wdListID,delete r.ftListId,"bye"),l.$on("openPanel",function(e,t){switch(t.panel){case"ADVANCED SEARCH":l.templates=!0,l.getDefaultTemplate(!0);break;case"DIRECT ACCESS":l.showDirectAccess();break;case"UPLOAD":l.showUpload();break;case"NEW TAB":l.openNewTab()}}),l.$on("favMattersEvent",function(e,t){l.cancelPanel()}),l.$on("cabinetEvent",function(e,t){l.cancelPanel()}),l.$on("setDialogStatus",function(e,t){l.fileErrorMessage=[],l.fileSuccessMessage=[],l.dialogTitle=t.action,"failed"==t.status?(l.fileErrorMessage.push(t),l.genericError=t.type):(l.checked=!1,l.fileSuccessMessage.push(t)),l.errorTypeDialog="action",l.fileError=!0}),l.$watch("wdView",function(e){if(l.resizeHomedataGrid(),e)return $(".dx-datagrid-rowsview.dx-fixed-columns .dx-scrollable-scrollbar").addClass("openViewPanel"),$("#homedataGrid .dx-resizable-handle-right").css("display","block"),!1;$("#homedataGrid .dx-resizable-handle-right").css("display","none"),$(".dx-datagrid-rowsview.dx-fixed-columns .dx-scrollable-scrollbar").removeClass("openViewPanel")}),l.scrollPreview={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-165},useNative:!0},l.expandPanel=!1,l.listOptions=[],l.viewType=!0,l.parentPanel=!1,l.visiblePopup=!1,a.$on("searchPanel",function(e,t){1==t.flag&&(l.templates=!0,DevExpress.ui.notify(t.message,"error",4e3))}),l.selectAttType=[{text:"Full copies of the files",value:0},{text:"In a Worldox file list (internal use only)",value:1},{text:"Encrypted container (i.e. a passworded ZIP file)",value:2}],l.attachPopup={showTitle:!0,title:"ATTACH",width:625,height:550,dragEnabled:!1,closeOnOutsideClick:!0,contentTemplate:"attached",bindingOptions:{visible:"visiblePopup"},onShowing:function(e){var t=$("#gridContainer").dxDataGrid("instance").getSelectedRowsData();l.attachedFiles=t,l.attachLength=t.length}},l.width_popupStatus=550,$(window).width()<768&&(l.width_popupStatus="80%"),l.fileErrorControl={showTitle:!0,width:"auto",height:"auto",shading:!1,closeOnOutsideClick:!0,contentTemplate:"fileError",bindingOptions:{visible:"fileError",title:"dialogTitle"},onShown:function(e){$("#errorView").dxScrollView("instance")}},l.errorBtn={text:"Open",type:"success",onClick:function(){l.$broadcast("openReadOnly")}},l.openTypeSelected={bindingOptions:{text:"openSelected"},type:"success",onClick:function(e){var t=$("#gridContainer").dxDataGrid("instance").getSelectedRowsData()[0];l.setFileActionDwnload(t,!0),l.fileError=!1}},l.setFileActionDwnload=function(e,t){var n={LN:e.LN,RN:e.RN,LID:e.LID,Status:e.I,DocId:e.DocId,tags:e.CAT_ID,Description:e.Description,profileGroupId:e.profileGroupId,Extension:e.Extension,FilePath:e.FilePath,ver:e.version};a.$broadcast("fileActionOpen",{data:n,listId:!1,attType:t})},l.attachMentsType=[{text:"A Full copy of the file",value:0},{text:"In a Worldox file list (internal use only)",value:1}],l.openTypeVerList={text:"Display the Version list",type:"success",onClick:function(e){var t=$("#gridContainer").dxDataGrid("instance").getSelectedRowsData();a.$broadcast("fileActionOpen",{data:t[0],listId:!0}),l.fileError=!1}},l.wdAttachType={dataSource:l.attachMentsType,value:l.attachMentsType[0].value,valueExpr:"value",onValueChanged:function(e){l.wdattachGroup=e.value}},l.wdAttachSend={text:"Attach",type:"success",onClick:function(e){var t=$("#gridContainer").dxDataGrid("instance").getSelectedRowsData()[0];if(0==l.wdattachGroup)return l.setFileActionDwnload(t,!1),!1;l.setWdlAttachment(t)}},l.setWdlAttachment=function(n){s.wdlOpen("New").then(function(e){var t=e.data.project;if(""!==t.errorStatus.ErrorCount)return console.log(t.errorStatus.wd_Error_MSG),!1;l.setWdlList(t.path,n)})},l.setWdlList=function(e,n){s.getWdList(e,0,200).then(function(e){var t=e.data.root.Header;if(""!==t.ErrorCount)return console.log(t.wd_Error_MSG),!1;l.setfileToWdl(n,t)})},l.setfileToWdl=function(n,r){s.fileToWdl(n.FilePathReal,r.List_ID).then(function(e){var t=e.data.fileStatus;if(""!==t.errorStatus.ErrorCount)return console.log(t.errorStatus.wd_Error_MSG),!1;l.nameWdl(n,r)})},l.nameWdl=function(e,n){s.setWdlName(e,n,0,1,-1).then(function(e){var t=e.data.setField;if(""!==t.errorStatus.ErrorCount)return console.log(t.errorStatus.wd_Error_MSG),!1;l.downloadWdl(n.List_ID)})},l.downloadWdl=function(e){var t={RN:"-1",LID:e,LN:0};s.download(t).then(function(e){var t=e.data.download;if(""!==t.errorStatus.errorStatus)return console.log(t.errorStatus.wd_Error_MSG),!1;console.log(t)})},l.attachedList={scrollByContent:!0,scrollByThumb:!0,height:150},l.attachType={items:l.selectAttType,valueExpr:"value"},l.attachSetName={value:!0,text:"Attach with Doc IDs instead of Document Descriptions."},l.sendAttach={text:"Send",type:"success"},l.classExpandIcon={"ms-Icon--BackToWindow":l.expandPanel,"ms-Icon--FullScreen":!l.expandPanel},l.init=function(){d.checkLocalStorage(),l.softpopFlag=1,t(function(){angular.element(document).ready(function(){for(var e=document.querySelectorAll(".dwnSpinner"),t=0;t<e.length;t++)new fabric.Spinner(e[t]);l.parentPanel=!0,a.wdDom=!1,l.resizeHomedataGrid()})},1e3),h=n.navigator.userAgent,l.softPop=!1,-1!=h.indexOf("Frowser")?(l.softPop=!0,w.attach?l.openSelected="Attach the Selected file":l.openSelected="Open the Selected file"):l.openSelected="Download the Selected file",l.checked=!1,l.wdView=!1,l.directAccess=!1,l.dwnSpinner=!0,l.hgt,l.projects=!1,l.queryTitle=w.query,l.showFilter=!0,l.templates=!1,l.uploadToggle=!1,l.openCats=!1;var e=$(window).innerHeight();e-=190,l.windowHeight={height:e+"px"},l.showUpload=function(){l.uploadToggle=!0,l.$broadcast("setFavQuick")},l.showDirectAccess=function(){l.directAccess=!0,l.$broadcast("setDirectAccess")},l.getDefaultTemplate=function(r){u.iniData("FindTemplatesList","1").then(function(e){var t=e.data.root,n={};if(""!=t.Header.ErrorCount)return DevExpress.ui.notify(t.Header.wd_Error_MSG,"error",4e3),!1;angular.forEach(t.items,function(e,t){"FindTemplatesTreePublic"!=e.K&&"FindTemplatesTreeOnlyMe"!=e.K&&"FindTemplatesTree"!=e.K&&"DefaultTab"!=e.K||(n[e.K]=e.D)}),l.setTemplate(n,r)},function(e){})},l.setTemplate=function(e,t){l.$broadcast("setTemplates",{defaults:e,type:t})},s.getColumnID().then(function(e){if(""!==e.data.root.errorStatus.ErrorCount)return DevExpress.ui.notify(e.data.root.errorStatus.wd_Error_MSG,"error",4e3),!1;r.columnId=e.data.root.data},function(e){o.error(e)})},l.loadPreviewWhenStartup=function(e){var n;r.isOpeningDocPanel&&(angular.forEach(e,function(e,t){if(e.DocId==r.currentFile.DocId)return n=e,!1}),void 0!==n&&(l.wdView=!0,l.filePage(r.currentFile),a.$broadcast("loadInfoPanelStartup",n),l.listOptions=[n],$("#gridContainer").dxDataGrid({onContentReady:function(e){e.component.selectRows([{DocId:r.currentFile.DocId}])}}).dxDataGrid("instance")))},l.toggle=function(e,t,n){l.listOptions=[e],l.wdView&&!t?(l.checked=t,l.wdView=!0,l.expandPanel=t,r.isOpeningDocPanel=t):l.wdView||t||(l.checked=t,l.wdView=t,l.expandPanel=t,r.isOpeningDocPanel=t),n&&(l.checked=t,l.wdView=t,l.expandPanel=t,r.isOpeningDocPanel=t)},l.toggleExpandPanel=function(){l.expandPanel=!l.expandPanel},l.cancelPanel=function(){d.setUploadPanel(1),a.viewOpt=d.getUploadPanel(),l.uploadToggle=!1,l.directAccess=!1,l.templates=!1,l.projects=!1,l.openCats=!1,l.$broadcast("closeCats",{panelupdate:!1}),l.$broadcast("closespinner")},l.openNewTab=function(){n.open("./landing","_blank")},l.setSelecteItems=function(e){return void 0!==e&&0!==e},l.marginBetweenPanels=10,l.homeFileMenuDefaultWidth=520,l.resizeHomedataGrid=function(){l.wdView&&parseInt($("#homeFileMenu").css("width"))<=0&&$("#homeFileMenu").css("width",l.homeFileMenuDefaultWidth);var e=l.wdView?$("#homeFileMenu").css("width"):0,t=parseInt($("#leftNav").innerWidth()),n=parseInt(window.innerWidth)-parseInt(e)-t-l.marginBetweenPanels+10;$("#homedataGrid").css("width",n),$(".dx-freespace-row").css("height",1)},l.validateAndResizeHomeFileMenu=function(e){var t=$("#gridContainer .dx-toolbar-after").width(),n=parseInt($("#leftNav").innerWidth()),r=null!=e.width&&0<e.width?parseInt(e.width):parseInt($("#homedataGrid").dxResizable("instance").option("width")),i=parseInt(window.innerWidth)-n-r-l.marginBetweenPanels+10,a=(parseInt(e.width),parseInt(t),parseInt($("#homeFileMenu").css("min-width"))),o=parseInt($("#homeFileMenu").css("max-width"));return 0<a&&i<=a||0<o&&o<=i?(l.resizeHomedataGrid(),!1):($("#homeFileMenu").css("width",i),!0)},l.setHomeResizable={minWidth:400,maxWidth:1200,handles:"right",onInitialized:function(e){var t=parseInt(window.innerWidth),n=$("#leftNav").innerWidth(),r=parseInt(t)-parseInt(n);$("#appBody").css("width",r)},onResize:function(e){setTimeout(function(){$("#listTitle").css({"max-width":"0px",width:"0px"}),$("#gridContainer").dxDataGrid("instance")._windowResizeCallBack(),a.setTitleHeaderWidth(),l.validateAndResizeHomeFileMenu(e)},-1)},onResizeStart:function(e){e.element.find(".dx-resizable-handle-right").css("background-color","#224e6e")},onResizeEnd:function(e){e.element.find(".dx-resizable-handle-right").removeAttr("style")}},l.setToggle=function(e){if(setTimeout(function(){$("#gridContainer").dxDataGrid("instance")._windowResizeCallBack()},-1),"WDL"!==e.Extension)return l.wdView=!0,r.isOpeningDocPanel=!0,l.resizeHomedataGrid(),!1;i.path("/home").search({query:"Project: "+encodeURIComponent(e.FilePath+"\\"+e.DocId)})},l.openVersionTab=function(e){l.checked=!0,r.isOpeningDocPanel=!0,$("#tabPanelItems").dxTabPanel({selectedIndex:3}),t(function(){$("#fileMenuTab3").click()},0)},l.errorType=function(e){var t;if(""!==e.errorStatus.wd_Error_DOCID)return t={title:e.errorStatus.wd_Error_DOCID,desc:e.errorStatus.wd_Error_DOCNAME,wdMsg:e.errorStatus.wd_Error_MSG},l.fileErrorMessage.push(t),l.genericError=!1,l.errorTypeDialog="action",!(l.fileError=!0);t={wdMsg:e.errorStatus.wd_Error_MSG},l.fileErrorMessage.push(t),l.genericError=!0,l.errorTypeDialog="action",l.fileError=!0},l.filePage=function(e){r.currentFile=e,l.loadPreview=!1,l.fileView="<p></p>",l.fileErrorMessage=[],l.fileSuccessMessage=[],a.timeStamp=Date.now(),c.getSession(e,a.timeStamp).then(function(e){var t,n=e.data.preview;if(n.errorStatus.req_ID==a.timeStamp){if(""!=n.errorStatus.ErrorCount)return l.errorType(n),l.fileView="<p>"+n.errorStatus.wd_Error_MSG+"</p>",!(l.loadPreview=!0);switch(t=n.fileLoc.split(".")[1]){case"HTM":l.viewType=!0,c.getPreview(n).then(function(e){var t=e.data.replace(/face="Times New Roman"/g,"");l.fileView=f.trustAsHtml(t),l.loadPreview=!0},function(e){console.log("Error to load resource.")});break;case"PDF":l.viewType=!1,PDFObject.embed(r.host+n.fileLoc,"#pdfViewer",{height:"inherit"}),l.loadPreview=!0;break;case"WDL":l.fileView="<p class='not-support'>WDL are not compatible.</p>",l.loadPreview=!0;break;case-1<["jpg","png","gif"].indexOf(t.toLowerCase())?t:"":l.viewType=!0,l.fileView='<img class="img-responsive" src="'+r.host+n.fileLoc+'" />',l.loadPreview=!0;break;default:console.log("blank")}l.loadPreview=!0}},function(e){DevExpress.ui.notify("IIS Server Error","error",4e3)})};var m,v,S=[],D=-1;m="Description",v=setInterval(function(){var e=$(".wdx-SearchBox"),t=$("#wdFilterBox .dx-texteditor-input"),n=$($("div.dx-datagrid-text-content:contains("+m+")").parent().parent().siblings().find("td")[2]),r=$("#leftNav .left-nav-vert ul.nav li .subMenu-wrap");"complete"===document.readyState&&0!==e.length&&0!==t.length&&0!==n.length&&(0!==e.length&&(S.push(".focussed_search"),e.addClass("focussed_search")),0!==t.length&&(S.push(".focussed_filter"),t.addClass("focussed_filter")),0!==n.length&&0<=n.attr("aria-label").indexOf(m)&&(S.push(".focussed_"+m),n.find("input.dx-texteditor-input").addClass("focussed_"+m)),$.each(r,function(e,t){var n=$(t).siblings().find(".nav-item-title").text().replace(/\s+/,"");$(t).find(".ms-SearchBox-field").addClass("leftMenu_"+n),S.push(".leftMenu_"+n)}),clearInterval(v))},100),$(document).keyup(function(e){e.shiftKey||9!==e.keyCode||t(function(){D===S.length-1?D=0:D++;return D}());e.shiftKey&&9===e.keyCode&&t(function(){0==D?D=S.length-1:D--;return D}());function t(e){0<=S[e].indexOf("leftMenu")?($(S[e]).parent().parent().siblings().trigger("click"),$(S[e]).focus()):$(S[e]).focus().click()}})}angular.module("WDWeb"),homeController.$inject=["$scope","$timeout","$localStorage","$window","$location","$rootScope","$log","wdService","homeService","providerService","previewService","leftNavService","uxService","$sce"],angular.module("WDWeb").controller("homeController",homeController).run(function(e,t,n){t.get("loader.html",{cache:e})});