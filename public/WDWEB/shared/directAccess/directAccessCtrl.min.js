angular.module("WDWeb").controller("directAccessCtrl",["$scope","$rootScope","$route","$routeParams","$timeout","$log","$window","$localStorage","$location","directAccess","wdService","homeService","leftNavService","$q",function(a,l,e,t,r,d,o,n,f,c,s,u,v,F){var p=this;p.showUploadLoader=!0,a.cabinetList=[],p.directUrl=!1,a.textValue="",a.directPlaceholder="",angular.element(o).bind("resize",function(){void 0!==$("#leftDirect").dxScrollView("instance")&&$("#leftDirect").dxScrollView("instance").option("height",window.innerHeight-225)}),a.wdFilterBox={placeholder:"Filter",elementAttr:{id:"wdFilterDirectAccess"},onEnterKey:function(e){p.fieldTableSpin=!1,a.textValue=e.event.target.value,"ft"==p.prefillData?p.searchFt():r(function(){p.fieldTableSpin=!0},1e3)},showClearButton:!0},a.wdFilterSideBtn={icon:"ms-Icon ms-Icon--Accept",onClick:function(e){p.fieldTableSpin=!1;var i=$("#wdFilterDirectAccess").dxTextBox("instance");a.textValue=i.option("value"),"ft"==p.prefillData?p.searchFt():r(function(){p.fieldTableSpin=!0},1e3)},elementAttr:{class:"wdFilterSideBtn"}},a.$on("setDirectAccess",function(e){p.showUploadLoader=!0,v.favMatters().then(function(e){var i=e.data.root;if(""!=i.Header.ErrorCount)return DevExpress.ui.notify(i.Header.wd_Error_MSG+"!","error",4e3),!1;p.showUploadLoader=!1,p.favMatters=i.FavMatters,console.log(p.favMatters),p.selected=i.FavMatters[0],a.setOverDirect()},function(e){d.error(e)}),s.getDirectCabinet().then(function(e){if(a.cabinetList=[],""!=e.data.root.Header.ErrorCount)return DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;for(i=0;i<e.data.root.Cabinets.length;i++)a.cabinetList.push(e.data.root.Cabinets[i]);a.setOverDirect()},function(e){console.log(e)})}),a.setOverDirect=function(){setTimeout(function(){$("#formDirectAccess").mouseover(function(e){l.checkOverDirAcc=!0}),$("#formDirectAccess").mouseout(function(e){l.checkOverDirAcc=!1})},100)},p.init=function(){p.checkFt=!1,p.moreTables=!1,r(function(){angular.element(document).ready(function(){for(var e=document.querySelectorAll(".fieldSpinner"),i=0;i<e.length;i++)new fabric.Spinner(e[i])})},0),p.fieldTableSpin=!0,a.directData={Cabinets:""},a.field={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},p.showPgFields={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},p.uploadToolBar=[{location:"before",text:"Direct Access"}],p.selectedField=0,p.prefillData="fm",p.uploadTitle="Favorite Matters",p.formTitle="Select a Cabinet",p.searchFt=function(){p.fieldListData="",p.fieldTableSpin=!1,r(function(){p.listTable(!1,!0)},-1e3)},p.setFavMatter=function(e){for(var i=angular.copy(e),l=[],t=1;t<=7;t++)if(e.hasOwnProperty("f"+t+"n")){var d="<span class='favAlign'><b>"+i["f"+t+"n"]+"</b> "+i["f"+t+"c"]+" "+i["f"+t+"d"]+"</span>";l.push(d)}return l.unshift("<h3>&nbsp;&nbsp;"+i.szPGID.toUpperCase()+"</h3>"),l.join("&nbsp;&nbsp;")},p.setFieldTableOrder=function(e){for(var i=[],l=1;l<=7;l++)if(e.hasOwnProperty("f"+l+"n")){var t=e["f"+l+"n"]+" ("+e["f"+l+"d"]+")";i.push(t)}return i.reverse().join(" - ")},p.setTooltip=function(e){return"<div class='custom-item'>"+e.pgName+"</div>"},a.fields={field1:{value:"",placeholder:"Field1",onValueChanged:function(e){a.fields.field1.value=e.value}},field2:{value:"",placeholder:"Field2",onValueChanged:function(e){a.fields.field2.value=e.value}},field3:{value:"",placeholder:"Field3",onValueChanged:function(e){a.fields.field3.value=e.value}},field4:{value:"",placeholder:"Field4",onValueChanged:function(e){a.fields.field4.value=e.value}},field5:{value:"",placeholder:"Field5",onValueChanged:function(e){a.fields.field5.value=e.value}},field6:{value:"",placeholder:"Field6",onValueChanged:function(e){a.fields.field6.value=e.value}},field7:{value:"",placeholder:"Field7",onValueChanged:function(e){a.fields.field7.value=e.value}}},p.fieldDesc={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""}},p.sendBtn={text:"Go",type:"success",useSubmitBehavior:!0,validationGroup:"directSearch"},a.sendTo=function(){p.directUrl=!0,s.checkProfile(a.directData,a.field).then(function(e){var i=e.data;if(""!=i.Header.ErrorCount)return p.showDetails(i),p.directUrl=!1;for(var l=1;l<=7;l++)p["wdFieldColor"+l]="#107c10";for(var t=0;t<a.cabinetList.length;t++)if(a.directData.Cabinets.split("|")[0]==a.cabinetList[t].pgID)return p.calculateData(a.cabinetList[t],i),!1},function(e){console.log(e)})},p.showDetails=function(e){var i=e.Profile.Fields;p.fieldDesc={field1:i.Field1.wd_File_Field_Error,field2:i.Field2.wd_File_Field_Error,field3:i.Field3.wd_File_Field_Error,field4:i.Field4.wd_File_Field_Error,field5:i.Field5.wd_File_Field_Error,field6:i.Field6.wd_File_Field_Error,field7:i.Field7.wd_File_Field_Error};for(var l=1;l<=7;l++)""!==i["Field"+l].wd_File_Field_Error?p["wdFieldColor"+l]="#a80000":p["wdFieldColor"+l]="#107c10"},p.calculateData=function(e,i){for(var l=e.pgFields.split("|"),t=[],d=1;d<l.length;d++)""!=l[d]&&t.push(a.field["field"+d]+" ("+p.fieldDesc["field"+d]+")");r(function(){p.directUrl=!1,f.path("/home").search({query:i.Profile.wdPath})},500)},p.wdButtons=function(e,i){$("#wdFilterDirectAccess").dxTextBox("instance").option("value",""),$(window).width()<=767&&($("#phxUpload .nav-save").css({display:"block",width:"100%","border-right":"0px"}),$("#phxUpload .saveForm").css({display:"none",width:"0%"})),p.prefillData=e,p.uploadTitle=i,p.selectedField=0,p.autoFilter="",p.checkFt=!1},p.getTables=function(e,i){$("#wdFilterDirectAccess").dxTextBox("instance").option("value",""),p.prefillData="",p.fieldListData=[],p.total="",p.ftCount="",p.fieldTableSpin=!1,p.maxcount=500,p.indexFr=0,p.uploadTitle=i,p.selectedField=e,p.fieldPanel=!0,p.autoFilter="",n.ftListId&&p.closeList(),r(function(){p.prefillData="ft",p.checkFt=!0,p.listTable(!1,!1)},-1e3)},p.listTable=function(l,e){s.getfieldTables(a.directData.Cabinets.split("|")[0],a.field,p.selectedField,p.maxcount,p.indexFr,e,a.textValue).then(function(e){if(p.total=e.data.root.Header.ListCount,p.listlength=e.data.root.FieldTbl.length,""!=e.data.root.Header.ErrorCount)return DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;if(n.ftListId=e.data.root.Header.List_ID,l){var i=p.fieldListData.concat(e.data.root.FieldTbl);p.listlength=i.length,p.fieldListData=i}else p.fieldListData=e.data.root.FieldTbl;p.total>p.maxcount?(p.moreTables=!0,p.checkFt=!0,p.ftCount=" "+p.listlength+" of "+p.total):("1"==p.total?p.ftCount=" 1 of 1":p.ftCount=" "+p.total+" of "+p.total,p.checkFt=!1),p.fieldNum=e.data.root.Header.FieldNum,p.listCount=parseInt(e.data.root.Header.ListCount),p.fieldNumber=p.selectedField,r(function(){p.fieldTableSpin=!0},1e3)},function(e){p.fieldTableSpin=!0,DevExpress.ui.notify("Server Error!","error",4e3),console.log(e)})},p.loadMore={text:"Load More",type:"success",useSubmitBehavior:!1,onClick:function(){p.indexFr=+p.indexFr+(p.maxcount+1),p.listTable(!0,!1)}},p.closeList=function(){s.clearListfromParm(n.ftListId).then(function(e){},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},p.scrollLeftNav={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-225},useNative:!0},p.setField=function(e){for(p.selected=e,i=1;i<=7;i++)e["f"+i+"n"]&&(a.field["field"+i]=e["f"+i+"n"],p.fieldDesc["field"+i]=e["f"+i+"d"]);p.autoSearch="",p.autoFilter=""},p.isActive=function(e){return p.selected===e},p.setSelected=function(e){p.selected=e},p.getUploadData=function(e,i){if(console.log(e),$(window).width()<=767&&($("#phxUpload .nav-save").css({display:"none",width:"0%"}),$("#phxUpload .saveForm").css({display:"block",width:"100%"})),p.selected=e,i){for(var l=1;l<=7;l++)if(0==e.hasOwnProperty("f"+[l]+"n")){e["f"+[l]+"n"]=""}for(l=1;l<=7;l++)if(0==e.hasOwnProperty("f"+[l]+"c")){e["f"+[l]+"c"]=""}}for(l=1;l<=7;l++)""==e["f"+l+"c"]&&(e["f"+l+"n"]="",e["f"+l+"c"]="",e["f"+l+"d"]=""),a.field["field"+l]=e["f"+l+"c"],p.fieldDesc["field"+l]=e["f"+l+"d"],p.autoFilter="";a.showField={Cabinets:e.dwPGID+"|"+e.f1c+"|"+e.f2c+"|"+e.f3c+"|"+e.f4c+"|"+e.f5c+"|"+e.f6c+"|"+e.f7c+"|"},a.directData={Cabinets:e.dwPGID+"|"+e.f1n+"|"+e.f2n+"|"+e.f3n+"|"+e.f4n+"|"+e.f5n+"|"+e.f6n+"|"+e.f7n+"|"},console.log(a.directData.Cabinets)},p.getFieldsDesc=function(e){var i=e.element[0].id.split("fieldDesc")[1];s.getFieldDes(a.directData.Cabinets.split("|")[0],a.field,i).then(function(e){var i=e.data.data.fields;p.fieldDesc={field1:i.field1,field2:i.field2,field3:i.field3,field4:i.field4,field5:i.field5,field6:i.field6,field7:i.field7};for(var l=1;l<=7;l++)p["wdFieldColor"+l]="#107c10"},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},a.selectedCabinet=function(e){console.log(e.value);for(var i=e.value.split("|"),l=1;l<=7;l++)""!=i[l]?p.showPgFields["field"+l]=i[l]:p.showPgFields["field"+l]="";if(void 0!==e.event&&(a.field={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},p.fieldDesc={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""}),"ft"==p.prefillData){var t=e.value.split("|");for(l=1;l<=7;l++)if(""!==t[l]){p.getTables(l,t[l]);break}}}}]).factory("directAccess",function(e){var i=[{dataField:"Cabinets",editorType:"dxSelectBox",editorOptions:{dataSource:[],valueExpr:"pgFields",displayExpr:"pgName"},validationRules:[{type:"required"}]},{dataField:"Field1",template:"Field1",label:{visible:!1},visible:!1},{dataField:"Field2",template:"Field2",label:{visible:!1},visible:!1},{dataField:"Field3",template:"Field3",label:{visible:!1},visible:!1},{dataField:"Field4",template:"Field4",label:{visible:!1},visible:!1},{dataField:"Field5",template:"Field5",label:{visible:!1},visible:!1},{dataField:"Field6",template:"Field6",label:{visible:!1},visible:!1},{dataField:"Field7",template:"Field7",label:{visible:!1},visible:!1}];return{directFields:function(){return i}}});