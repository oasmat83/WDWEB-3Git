angular.module("WDWeb").controller("templateCtrl",["$scope","$rootScope","$route","$routeParams","$timeout","$log","$window","$localStorage","$location","template","wdService","homeService","leftNavService",function(r,a,e,t,d,n,l,o,s,f,c,p,u){var m=this,h=[],T=s.search();r.contextualItems=[{text:"Set Default",icon:"ms-Icon ms-Icon--Heart"}],m.templates=[],m.userTemps=[],m.publicTemps=[],m.fieldTableSpin=!0,m.getQaCabinets="",m.pgName=[],m.checkFt=!1,m.moreTables=!1,r.gridBoxValue=[],m.publicTempData={},m.userTempData={},m.templatesData={},m.isTemplate=!0,r.selectedpg=[],m.showTempleLoader=!0,r.textValue="",r.wdFilterBox={placeholder:"Filter",elementAttr:{id:"wdFilterTemplate"},onEnterKey:function(e){m.fieldTableSpin=!1,r.textValue=e.event.target.value,"ft"==m.prefillData?m.searchFt():d(function(){m.fieldTableSpin=!0},1e3)},showClearButton:!0},r.wdFilterSideBtn={icon:"ms-Icon ms-Icon--Accept",onClick:function(e){m.fieldTableSpin=!1;var t=$("#wdFilterTemplate").dxTextBox("instance");r.textValue=t.option("value"),"ft"==m.prefillData?m.searchFt():d(function(){m.fieldTableSpin=!0},1e3)},elementAttr:{class:"wdFilterSideBtn"}},m.tempForm={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",useNative:!0},m.tempMenu={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",useNative:!0},r.$on("closespinner",function(e,t){m.showTempleLoader=!0,m.prefillData="",m.formTitle="Search..."}),r.$on("setTemplates",function(e,l){m.setType=l.type,c.getCabinetList().then(function(e){r.cabinetList=[];var t=e.data.root;if(""!=t.Header.ErrorCount)return DevExpress.ui.notify(t.Header.wd_Error_MSG+"!","error",4e3),!1;for(i=0;i<t.Cabinets.length;i++)r.cabinetList.push(t.Cabinets[i]);r.cabinetList,m.defaultList=l,m.getTemplateList(!1,l.defaults.DefaultTab,l),r.setOverAddSear()},function(e){console.log(e)})}),r.setOverAddSear=function(){setTimeout(function(){$("#phxTemplate").mouseover(function(e){a.checkOverAddSear=!0}),$("#phxTemplate").mouseout(function(e){a.checkOverAddSear=!1})},100)},m.getDefaultTemplate=function(i){u.iniData("FindTemplatesList","1").then(function(e){var t=e.data.root,l={};if(""!=t.Header.ErrorCount)return DevExpress.ui.notify(t.Header.wd_Error_MSG,"error",4e3),!1;angular.forEach(t.items,function(e,t){"FindTemplatesTreePublic"!=e.K&&"FindTemplatesTreeOnlyMe"!=e.K&&"FindTemplatesTree"!=e.K&&"DefaultTab"!=e.K||(l[e.K]=e.D)}),m.resetTemplate(i,l[m.wdTemplateType])},function(e){})},m.getTemplateList=function(e,t,l){var i="";i=m.setType?t:0,c.getTemplate(i).then(function(e){var t=e.data.root;if(""!=t.Header.ErrorCount)return DevExpress.ui.notify(getResponse.Header.wd_Error_MSG+"!","error",4e3),!1;m.templates=t.items,m.setDefaultTab(l.defaults),m.showTempleLoader=!1,r.setOverAddSear()},function(e){n.error(e)})},m.setDefaultTab=function(e){m.setType?"1"==e.DefaultTab||""==e.DefaultTab||null==e.DefaultTab||"0"==e.DefaultTab?(m.prefillData="all",m.templateType="All Templates",m.setDefaultTemplate(e.FindTemplatesTree)):"2"==e.DefaultTab?(m.prefillData="ut",m.templateType="User Templates",m.setDefaultTemplate(e.FindTemplatesTreeOnlyMe)):(m.prefillData="st",m.templateType="Global Templates",m.setDefaultTemplate(e.FindTemplatesTreePublic)):m.setTemplate(e)},m.setTemplate=function(e){m.prefillData="all",m.templateType="All Templates";var l="",t=!0;l=a.searchTemplateType?(t=!1,o.templateName):"Quick Access",angular.forEach(m.templates,function(e,t){if(e.name==l)return m.getTemplateData(e,!0),!1}),m.setDefaultTemplate(e.FindTemplatesTree),m.setFieldWith(),t||m.setFieldValue()},m.setFieldValue=function(){angular.forEach(["xName","fName","access","create","modified","text","field1","field2","field3","field4","field5","field6","field7","cabinet"],function(e,t){if(""===T[e]||"access"!=e&&"create"!=e&&"modified"!=e){if(""!==T[e]&&("xName"==e||"fName"==e||"text"==e||"field1"==e||"field2"==e||"field3"==e||"field4"==e||"field5"==e||"field6"==e||"field7"==e)){i="";switch(e){case"xName":i=1;break;case"fName":i=2;break;case"text":i=17;break;case"field1":i=10;break;case"field2":i=11;break;case"field3":i=12;break;case"field4":i=13;break;case"field5":i=14;break;case"field6":i=15;break;case"field7":i=16}r.field["field"+i]=T[e]}}else{var l=T[e].split("."),i="";switch(e){case"access":i=23;break;case"create":i=9;break;case"modified":i=4;break;default:i=41}r.field["field"+i].start=l[0]+"."+l[1],r.field["field"+i].end="."+l[2]+"."+l[3]}})},m.getListFromWdBtn=function(e,t,l,i){c.getTemplate(t).then(function(e){var t=e.data.root;if(""!=t.Header.ErrorCount)return DevExpress.ui.notify(getResponse.Header.wd_Error_MSG+"!","error",4e3),!1;m.templates=t.items,m.setDefaultTemplate(m.defaultList.defaults[i]),m.showTempleLoader=!1,r.setOverAddSear()},function(e){n.error(e)})},m.setFieldWith=function(){if(T.query){if(-1!==T.query.indexOf("?t")){var e=T.query.split("?t ")[1];r.field.field17=e}-1==T.query.indexOf("?t")&&(r.field.field1=T.query)}},m.setDefaultTemplate=function(l){angular.forEach(m.templates,function(e,t){m.setdefault(e,l)})},m.setdefault=function(e,t){e.name==t&&(e.default=!0,m.setType&&m.getTemplateData(e,!0))},r.onFormSubmit=function(e){var n,t,r;n=[".0.0","0.0"],t=["end","start"],r=[{id:4,name:"Modified"},{id:9,name:"Created"},{id:23,name:"Accessed"},{id:41,name:"Email"}],[4,9,23,41].forEach(function(a){$("#"+a+"-start,#"+a+"-end").dxValidator({validationRules:[]});var d="";t.forEach(function(e){var t="start"==e?"end":"start",l="start"==t?"From":"To";try{if(d=$("#"+a+"-"+e).dxSelectBox("instance").option("value"),d=!(-1<n.indexOf(d))&&d){var i=r.find(function(e){return e.id==a}).name;$("#"+a+"-"+t).dxValidator({validationRules:[{type:"required",message:i+" ("+l+") is required"}]})}else $("#"+a+"-"+e).dxSelectBox("instance").option("value","")}catch(e){}})}),e.validationGroup.validate().isValid&&m.sendTo()},r.submitButtonOptions={text:"Search",type:"success",onClick:r.onFormSubmit},m.closeList=function(){c.clearListfromParm(o.ftListId).then(function(e){},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},m.setFieldTableOrder=function(e){for(var t=[],l=1;l<=7;l++)if(e.hasOwnProperty("f"+l+"n")){var i=e["f"+l+"n"]+" ("+e["f"+l+"d"]+")";t.push(i)}return t.reverse().join(" - ")},r.customItemTemplate=function(e){var t="<div>"+e.pgName+"</div>";return 15<e.pgName.length&&(t="<div title='"+e.pgName+"'>"+e.pgName+"</div>"),t},r.$on("defaultTemp",function(e,l){var t,i;d(function(){i="FindTemplatesTreePublic"===l.type?(t=m.publicTemps,"public"):"FindTemplatesTreeOnlyMe"===l.type?(t=m.userTemps,"personal"):(t=m.templates,"all"),angular.forEach(t,function(e,t){if(e.name==l.template)return m.getTemplateData(e,l.instant),"personal"==i?(m.prefillData="ut",m.templateType="User Templates",m.userTempData={item:e,instant:l.instant}):"public"==i?(m.prefillData="st",m.templateType="Global Templates",m.publicTempData={item:e,instant:l.instant}):(m.prefillData="all",m.templateType="All Templates",m.templatesData={item:e,instant:l.instant}),!1})},1e3)}),a.$on("searchPanel",function(e,t){if(1==t.flag){m.getTemplateList(!0),m.prefillData="all",m.templateType="Default";var l=t.message.split(".")[0];if(m.isTemplate=!1,m.defaultMessage=l+", please narrow down your search.",-1!==T.query.indexOf("?t")){t=T.query.split("?t ")[1];r.field.field17=t}-1==T.query.indexOf("?t")&&(r.field.field1=T.query)}r.$broadcast("setTemplates")}),m.filterLabelTable=function(){m.fieldTableSpin=!1,d(function(){m.fieldTableSpin=!0},1e3)},m.getMultiCabinet={bindingOptions:{dataSource:"cabinetList",value:"gridBoxValue"},valueExpr:"pgFields",displayExpr:"pgName",placeholder:"Select a cabinet...",onValueChanged:function(e){r.gridBoxValue=e.value},multiList:{bindingOptions:{dataSource:"cabinetList",selectedRowKeys:"gridBoxValue"},keyExpr:"pgFields",columns:["pgName"],showColumnHeaders:!1,selection:{mode:"multiple",showCheckBoxesMode:"always"},height:200,paging:{pageSize:255},elementAttr:{id:"popupformtest"},onSelectionChanged:function(l){var i="";angular.forEach(l.selectedRowsData,function(e,t){t===l.selectedRowsData.length-1?i+=e.pgID:i+=e.pgID+","}),c.setPgFields(i).then(function(e){m.setWdPgFields(e)},function(e){console.log(e)}),r.gridBoxValue=l.selectedRowKeys}}},m.setWdPgFields=function(e){var t=e.data.root,l=t.items[0];if(""!==t.Header.ErrorCount)return DevExpress.ui.notify(t.Header.wd_Error_MSG,"error",4e3),!1;angular.forEach(l.Fields,function(e,t){var l=parseInt(1)+t;0==e.ACTIVE?(m.showPgFields["field"+l]=!1,r.fieldData["field"+l].placeholder=""):(m.showPgFields["field"+l]=!0,r.fieldData["field"+l].placeholder=e.NAME)})},m.getCabinetName=function(){var e=document.createElement("ul"),t=document.createElement("span"),l=document.createElement("div");e.classList.add("tipList"),t.innerHTML="<b>Multiple Cabinets</b> <br/>";for(var i=0;i<m.pgName.length;i++){var a=document.createElement("li");a.innerHTML="<span class='ms-Icon ms-Icon--NavigateBackMirrored'></span>&nbsp;&nbsp;"+m.pgName[i],e.appendChild(a)}return l.appendChild(t),l.appendChild(e),l.outerHTML},m.showFields={field1:!0,field2:!0,field9:!0,field4:!0,field23:!0,field17:!0,field19:!0,field10:!0,field11:!0,field12:!0,field13:!0,field14:!0,field15:!0,field16:!0,field8:!0,field37:!0,field38:!0,field39:!0,field40:!0,field41:!0,field46:!0},m.formTitle="Search...",m.searchFt=function(){m.fieldListData="",m.fieldTableSpin=!1,d(function(){m.listTable(!1,!0)},1e3)},m.showPgFields={},r.cabinetList=[],r.fieldDesc={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},r.field={field1:"",field2:"",field4:{start:"",end:""},field9:{start:"",end:""},field23:{start:"",end:""},field17:"",field10:"",field11:"",field12:"",field13:"",field14:"",field15:"",field16:"",field8:"",field37:"",field38:"",field39:"",field40:"",field41:{start:"",end:""},field46:""},m.setTabName=function(e){m.prefillData=e,m.templateType="all"==e?"All Templates":"ut"==e?"User Templates":"Global Templates"},m.contextTabTemplate=function(e,t,l,i){return{target:"#"+e,dataSource:r.contextualItems,width:200,onItemClick:function(e){m.wdTemplateType=i,m.setTabName(l),m.setDefaultKey("FindTemplatesList",t,"DefaultTab",1,!0)}}},m.contextMenuTemplate=function(i){return{target:"#"+i.Index,dataSource:r.contextualItems,width:200,onItemClick:function(e){var t=i.name,l="";switch(m.prefillData){case"st":l="FindTemplatesTreePublic";break;case"ut":l="FindTemplatesTreeOnlyMe";break;case"all":l="FindTemplatesTree"}m.setDefaultKey("FindTemplatesList",t,l,1,!1)}}},m.setDefaultKey=function(e,l,i,t,a){u.iniDataSet(e,l,i,t).then(function(e){var t=e.data.root;return""!=t.Header.ErrorCount?(DevExpress.ui.notify(t.Header.wd_Error_MSG,"error",4e3),!1):a?void m.getDefaultTemplate(l):(m.setNewDefault(i,l),!1)},function(e){DevExpress.ui.notify("IIS error 500","error",4e3)})},m.resetTemplate=function(e,l){m.showTempleLoader=!0,c.getTemplate(e).then(function(e){var t=e.data.root;if(""!=t.Header.ErrorCount)return DevExpress.ui.notify(getResponse.Header.wd_Error_MSG+"!","error",4e3),m.showTempleLoader=!1;m.templates=t.items,angular.forEach(m.templates,function(e,t){e.name==l&&m.getTemplateData(e,!0)}),m.setNewDefault(m.wdTemplateType,l),m.showTempleLoader=!1},function(e){m.showTempleLoader=!1,n.error(e)})},m.setNewDefault=function(e,l){angular.forEach(m.templates,function(e,t){1==e.default&&(e.default=!e.default),e.name==l&&(e.default=!e.default)})},m.startDate=p.getStart(),m.endDate=p.getEnd(),m.fields={field1:{value:""},field2:{value:""},field3:{value:""},field4:{value:""},field5:{value:""},field6:{value:""},field7:{value:""}},m.init=function(){r.listFields,m.fieldSpin=!0,m.templateType="Global Templates",m.uploadToolBar=[{location:"before",text:"Advanced Search"}],r.fieldData={name:{placeholder:"Description"},docId:{placeholder:"Doc Id"},owner:{placeholder:"Owner"},created:{placeholder:"Date Created"},modified:{placeholder:"Date Modified"},accessed:{placeholder:"Date Accessed"},text:{placeholder:"Text in file"},cabinet:{value:"",placeholder:"Cabinets"},field1:{placeholder:"Field1"},field2:{placeholder:"Field2"},field3:{placeholder:"Field3"},field4:{placeholder:"Field4"},field5:{placeholder:"Field5"},field6:{placeholder:"Field6"},field7:{placeholder:"Field7"},tags:{placeholder:"Tags"},searchWhat:{placeholder:"Search What"},from:{placeholder:"Email From"},to:{placeholder:"Email To"},cc:{placeholder:"Email CC"},bcc:{placeholder:"Email BCC"},sent:{placeholder:"Email Sent"},addr:{placeholder:"Email Addr"}},d(function(){angular.element(document).ready(function(){for(var e=document.querySelectorAll(".ms-Spinner"),t=0;t<e.length;t++)new fabric.Spinner(e[t])})},1e3)},m.wdButtons=function(e,t,l,i){m.showTempleLoader=!0,r.textValue="",$(window).width()<=767&&($("#phxTemplate .nav-save").css({display:"block",width:"100%","border-right":"0px"}),$("#phxTemplate .saveForm").css({display:"none",width:"0%"})),m.prefillData=e,m.templateType=t,m.selectedField=0,m.autoFilter="",m.checkFt=!1,m.setType=!0,m.getListFromWdBtn(!1,l,m.defaultList,i)},m.getTemplateData=function(a,e){if(m.wdTempFields=a.Fields,m.selected=a,m.formTitle=a.name,m.isTemplate=!0,r.field={field1:"",field2:"",field4:{start:"",end:""},field9:{start:"",end:""},field23:{start:"",end:""},field17:"",field10:"",field11:"",field12:"",field13:"",field14:"",field15:"",field16:"",field8:"",field37:"",field38:"",field39:"",field40:"",field41:"",field46:""},m.templateName=a.name,m.showFields={field1:!1,field2:!1,field9:!1,field4:!1,field23:!1,field17:!1,field19:!1,field10:!1,field11:!1,field12:!1,field13:!1,field14:!1,field15:!1,field16:!1,field8:!1,field37:!1,field38:!1,field39:!1,field40:!1,field41:!1,field46:!1},m.fieldSpin=!1,"0"==(m.selected=a).bGO||0==e)return $(window).width()<=767&&($("#phxTemplate .nav-save").css({display:"none",width:"0%"}),$("#phxTemplate .saveForm").css({display:"block",width:"100%"})),angular.forEach(m.wdTempFields,function(e,t){if(m.showFields["field"+e.EID]=!0,"9"==e.EID||"4"==e.EID||"23"==e.EID||"41"==e.EID){var l=e.DEF.split(".");r.field["field"+e.EID].start=l[0]+"."+l[1],r.field["field"+e.EID].end="."+l[2]+"."+l[3]}else if("19"==e.EID){var i=(e.DEF.match(/;/g)||[]).length;m.setCabinet(i,a,e.DEF)}else r.field["field"+e.EID]=e.DEF}),!1;s.path("/home").search({query:"?@ "+a.name})},m.setCabinet=function(e,t,l){var i=[];if(0==e){var a=m.setPgFields(t);i.push(l+"|"+a),m.setPgFieldValue(i),m.setfieldLabelPlaceholder()}else{var d=l.split(";");m.setPgFields(t),angular.forEach(d,function(l,e){angular.forEach(r.cabinetList,function(e,t){e.pgID===l&&i.push(e.pgFields)})}),m.setPgFieldValue(i),m.setfieldLabelPlaceholder()}},m.setPgFieldValue=function(e){var t=$("#wdMultiCabinet").dxDropDownBox("instance");null==t?r.gridBoxValue=e:t.option("value",e)},m.setPgFields=function(e){var t=angular.copy(e.Fields);m.setpgFieldData={},m.setCabinetValue={},angular.forEach(t,function(e,t){"10"!=e.EID&&"11"!=e.EID&&"12"!=e.EID&&"13"!=e.EID&&"14"!=e.EID&&"15"!=e.EID&&"16"!=e.EID||(m.setpgFieldData["field"+e.EID]=!0,m.setCabinetValue["field"+e.EID]=e.LAB)});for(var l=10;l<=16;l++)null==m.setpgFieldData["field"+l.toString()]&&(m.setpgFieldData["field"+l.toString()]=!1,m.setCabinetValue["field"+l.toString()]="");return m.showPgFields={field1:m.setpgFieldData.field10,field2:m.setpgFieldData.field11,field3:m.setpgFieldData.field12,field4:m.setpgFieldData.field13,field5:m.setpgFieldData.field14,field6:m.setpgFieldData.field15,field7:m.setpgFieldData.field16},m.setCabinetValue.field10+"|"+m.setCabinetValue.field11+"|"+m.setCabinetValue.field12+"|"+m.setCabinetValue.field13+"|"+m.setCabinetValue.field14+"|"+m.setCabinetValue.field15+"|"+m.setCabinetValue.field16+"|"},m.setfieldLabelPlaceholder=function(){for(var e=10,t=1;t<7;e++,t++)r.fieldData["field"+t].placeholder=m.setCabinetValue["field"+e]},m.getActiveFields=function(e){for(var t=[],l=[],i=(r.gridBoxValue=e).length,a=0;a<i;a++)for(var d=e[a].split("|"),n=0;n<d.length;n++)t[n]?t[n].word===d[n]&&t[n].count++:(t[n]={},t[n].word=d[n],t[n].count=1);for(a=0;a<t.length;a++)t[a].count===i?l[a]=t[a].word:l[a]="";l.shift(),l.pop(),m.showField(l)},m.showField=function(e){for(var t=0;t<e.length;t++){var l=parseInt([t])+parseInt(1);""!=e[t]?(m.showPgFields["field"+l]=e[t],r.fieldData["field"+l].placeholder=e[t]):m.showPgFields["field"+l]=""}0==e.length&&(m.showPgFields={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""})},m.isActive=function(e){return m.selected===e},m.multiCabinet=function(e){for(var t=0;t<r.cabinetList.length;t++)e==r.cabinetList[t].pgID&&h.push(r.cabinetList[t].pgFields.split("|"))},m.getFieldsDesc=function(e){var t=e.element[0].id.split("fieldDesc")[1];c.getFieldDesTemp(r.fieldData.cabinet.value.split("|")[0],r.field,t).then(function(e){var t=e.data.data.fields;r.fieldDesc={field1:t.field1,field2:t.field2,field3:t.field3,field4:t.field4,field5:t.field5,field6:t.field6,field7:t.field7}},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},m.checkValue=function(e){var t="";return" "!=e.Filter&&(t=e.Filter),t},r.displayDateValue=function(){$("#phxUpload .saveForm .dx-scrollview-content").width()-270<=125?$(".lbl-option-detail").hide():$(".lbl-option-detail").show()},window.onresize=function(){r.displayDateValue()},m.changeDate=function(t){r.displayDateValue();var e=t.element[0].id.split("-");if("9-start"==t.element[0].id&&m.startDate.forEach(function(e){e.value==t.value&&$("#created-from").html(e.date)}),"9-end"==t.element[0].id&&m.endDate.forEach(function(e){e.value==t.value&&$("#created-to").html(e.date)}),"4-start"==t.element[0].id&&m.startDate.forEach(function(e){e.value==t.value&&$("#modified-from").html(e.date)}),"4-end"==t.element[0].id&&m.endDate.forEach(function(e){e.value==t.value&&$("#modified-to").html(e.date)}),"23-start"==t.element[0].id&&m.startDate.forEach(function(e){e.value==t.value&&$("#accessed-from").html(e.date)}),"23-end"==t.element[0].id&&m.endDate.forEach(function(e){e.value==t.value&&$("#accessed-to").html(e.date)}),"start"==e[1])return r.field["field"+e[0]].start=t.value,!1;r.field["field"+e[0]].end=t.value},m.getTables=function(e,t){$("#wdFilterTemplate").dxTextBox("instance").option("value",""),m.fieldListData=[],m.prefillData="",m.total="",m.ftCount="",m.selectedField=e,m.templateType=t,m.autoFilter="",m.maxcount=500,m.indexFr=0,m.pgCabinetID="",o.ftListId&&m.closeList(),1==r.gridBoxValue.length?(m.prefillData="ft",m.checkFt=!0,m.fieldTableSpin=!1,d(function(){m.pgCabinetID=r.gridBoxValue[0].split("|")[0],m.listTable(!1,!1)},1e3)):(angular.forEach(r.cabinetList,function(l,e){angular.forEach(r.gridBoxValue,function(e,t){l.pgID==e.split("|")[0]&&(l.text=l.pgName,r.selectedpg.push(l))})}),$("#wdMenu"+e).dxContextMenu("instance").show())},m.selectCabinet=function(e){return{target:"#wdMenu"+e,bindingOptions:{dataSource:"selectedpg"},width:200,onItemClick:function(e){r.selectedpg=[],m.prefillData="ft",m.checkFt=!0,m.pgCabinetID=e.itemData.pgID,m.listTable(!1,!1)},onHidden:function(e){r.selectedpg=[]}}},m.listTable=function(l,e){for(var t=1,i=10;t<=7;t++,i++)m.fields["field"+[t]].value=r.field["field"+[i]];c.fieldTables(m.pgCabinetID,m.fields,m.selectedField,m.maxcount,m.indexFr,e,r.textValue).then(function(e){if(m.total=e.data.root.Header.ListCount,m.listlength=e.data.root.FieldTbl.length,""!=e.data.root.Header.ErrorCount)return DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;if(o.ftListId=e.data.root.Header.List_ID,l){var t=m.fieldListData.concat(e.data.root.FieldTbl);m.listlength=t.length,m.fieldListData=t}else m.fieldListData=e.data.root.FieldTbl;m.total>m.maxcount?(m.moreTables=!0,m.checkFt=!0,m.ftCount=" "+m.listlength+" of "+m.total):("1"==m.total?m.ftCount=" 1 of 1":m.ftCount=" "+m.total+" of "+m.total,m.checkFt=!1),m.fieldNum=e.data.root.Header.FieldNum,d(function(){m.fieldTableSpin=!0},1e3)},function(e){DevExpress.ui.notify("Fatal IIS error","error",4e3)})},m.getToolTip=function(e){var t="";for(i=1;i<=7;i++)e["f"+i+"n"]&&(t+=t=e["f"+i+"n"]+" - "+e["f"+i+"d"]+" | ");return t.substring(0,t.length-2)},m.loadMore={text:"Load More",type:"success",useSubmitBehavior:!1,onClick:function(){m.indexFr=+m.indexFr+(m.maxcount+1),m.listTable(!0,!1)}},m.setField=function(e){m.selected=e;for(var t=1,l=10;t<=7;t++,l++)e["f"+t+"n"]&&(r.field["field"+[l]]=e["f"+t+"n"],r.fieldDesc["field"+[t]]=e["f"+t+"d"]);m.autoSearch="",m.autoFilter=""},m.setSelected=function(e){m.selected=e},m.sendTo=function(){var i=[];a.searchTemplateType=!0,angular.forEach(r.gridBoxValue,function(e,t){var l=e.split("|")[0];i.push(l)}),m.isTemplate?m.templateName:m.templateName=s.search().query,[].push(m.templateName),o.templateName=m.templateName,s.path("/home").search({xName:r.field.field1,fName:r.field.field2,access:r.field.field23.start+r.field.field23.end,create:r.field.field9.start+r.field.field9.end,modified:r.field.field4.start+r.field.field4.end,text:r.field.field17,field1:r.field.field10,field2:r.field.field11,field3:r.field.field12,field4:r.field.field13,field5:r.field.field14,field6:r.field.field15,field7:r.field.field16,cabinet:i.toString(),typeid:"template",temp:m.templateName,id:Date.now()})}}]).factory("template",function(e){var t=[{itemType:"group",items:[{dataField:"Name",visible:!1,editorOptions:{placeholder:"Name",width:"100%"}},{dataField:"Doc Id",visible:!1,editorOptions:{placeholder:"Doc Id",width:"100%"}},{dataField:"Date Created",visible:!1,editorOptions:{placeholder:"Date Created",width:"100%"}},{dataField:"Date Modified",visible:!1,editorOptions:{placeholder:"Date Modified",width:"100%"}},{dataField:"Date Accessed",visible:!1,editorOptions:{placeholder:"Date Accessed",width:"100%"}},{dataField:"Text in File",visible:!1,editorOptions:{placeholder:"Text in File",width:"100%"}},{dataField:"Cabinets",visible:!1,editorType:"dxSelectBox",editorOptions:{dataSource:cabinetList,valueExpr:"pgFields",displayExpr:"pgName"}},{dataField:"Field1",template:"Field1",label:{visible:!1},visible:!1},{dataField:"Field2",visible:!1,editorOptions:{placeholder:"Field2",width:"100%"}},{dataField:"Field3",visible:!1,editorOptions:{placeholder:"Field3",width:"100%"}},{dataField:"Field4",visible:!1,editorOptions:{placeholder:"Field4",width:"100%"}},{dataField:"Field5",visible:!1,editorOptions:{placeholder:"Field5",width:"100%"}},{dataField:"Field6",visible:!1,editorOptions:{placeholder:"Field6",width:"100%"}},{dataField:"Field7",visible:!1,editorOptions:{placeholder:"Field7",width:"100%"}},{dataField:"Tags",visible:!1,editorOptions:{placeholder:"Tags",width:"100%"}},{dataField:"Search What",visible:!1,editorOptions:{placeholder:"Search What",width:"100%"}},{dataField:"Owner",visible:!1,editorOptions:{placeholder:"Owner",width:"100%"}},{dataField:"Email From",visible:!1,editorOptions:{placeholder:"Email From",width:"100%"}},{dataField:"Email To",visible:!1,editorOptions:{placeholder:"Email To",width:"100%"}},{dataField:"Email CC",visible:!1,editorOptions:{placeholder:"Email CC",width:"100%"}},{dataField:"Email BCC",visible:!1,editorOptions:{placeholder:"Email BCC",width:"100%"}},{dataField:"Email Sent",visible:!1,editorOptions:{placeholder:"Email Sent",width:"100%"}},{dataField:"Email Addr",visible:!1,editorOptions:{placeholder:"Email Addr",width:"100%"}}]}];return{tempFields:function(){return t}}});