"use strict";angular.module("WDWeb").controller("fileMenuCtrl",["$scope","$rootScope","$timeout","$localStorage","$location","$log","$route","$window","wdService","uxService","loginService","WORLDOX_HOST","profileService",function(r,e,t,a,o,l,i,c,d,n,s,u,p){var f,m={};r.profileType=!1,r.selectedTab="",r.fieldLabels={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},f=c.navigator.userAgent,r.initMenu=function(){r.fieldContainer={Field1:!1,Field2:!1,Field3:!1,Field4:!1,Field5:!1,Field6:!1,Field7:!1},r.dwnSpinner=!0,r.spinner=!0},r.tabPanelItems={dataSource:[{title:"Profile",icon:"ms-Icon ms-Icon--ContactCard",template:"profile",options:{elementAttr:{id:"wdEditProfileTab"}},onClick:function(e){}},{title:"Email",icon:"ms-Icon ms-Icon--Mail",template:"email"}],deferRendering:!1,animationEnabled:!0,swipeEnabled:!1,selectedIndex:0,height:"100%",onContentReady:function(e){e.element.find(".dx-tab").each(function(e){$(this).attr({id:"fileMenuTab"+e})})},onTitleClick:function(e){if(r.selectedTab=e.itemData.title,r.checkMessage="","Profile"===e.itemData.title?r.profileType=!1:r.profileBtn="","View"===e.itemData.title){var o=$("#gridContainer").dxDataGrid("instance").getSelectedRowsData();r.filePage(o.pop())}}};var h={name:""};r.checkinBtn={text:"Check In",type:"success",useSubmitBehavior:!0},r.chkintypeObj=[{display:"Replace over original",id:"R"},{display:"Add as new version",id:"N"},{display:"Revert back to original",id:"D"}],r.checkinType={formData:{Action:""},readOnly:!1,showColonAfterLabel:!1,showValidationSummary:!1,labelLocation:"top",colCount:1,validationGroup:"actionType",onInitialized:function(e){formInstance=e.component},items:n.getAction()},r.chkinValue="",r.getChkinData=function(e){r.chkinValue=e.value},r.chkinType={bindingOptions:{dataSource:"chkinTypeObj"},value:"chkinValue",valueExpr:"id",displayExpr:"display"},r.checkInSubmit=function(){r.spinner=!1,m=d.getFileData(),"D"==r.chkinValue?d.checkIn(m).then(function(e){if(""!=e.data.fileStatus.errorStatus.ErrorCount)return DevExpress.ui.notify(e.data.fileStatus.errorStatus.wd_Error_MSG,"error",4e3),!1;t(function(){DevExpress.ui.notify("DocID: "+m.DocId+" checked in 'SUCCESSFULLY'!","success",4e3),r.listOptions[0].I="0",r.spinner=!0},5e3)},function(e){DevExpress.ui.notify("DocID: "+m.DocId+" 'FAILED' to check in!","error",4e3),l.log(e),i.reload()}):"R"==r.chkinValue?r.uploadToWorldox("",r.value.length):"N"==r.chkinValue?r.uploadToWorldox("1",r.value.length):(r.spinner=!0,DevExpress.ui.notify("Please select a save type","error",4e3))},r.uploadToWorldox=function(e,o){if(m=d.getFileData(),0===o)return DevExpress.ui.notify("Please upload a file to Check-In","error",4e3),!(r.spinner=!0);d.uploadToWorldox(e,m,h.name).then(function(e){var o=e.data.uploadVerb;if(""!=o.errorStatus.ErrorCount)return DevExpress.ui.notify(o.errorStatus.wd_Error_MSG,"error",4e3),!(r.spinner=!0);r.chkToWorldox()},function(e){DevExpress.ui.notify("DocID: "+m.DocId+" 'FAILED' to checked in!","error",4e3),l.log(e),i.reload()})},r.chkToWorldox=function(){m=d.getFileData(),d.chkToWorldox(m,h.name).then(function(e){var o=e.data.fileStatus;if(""!=o.errorStatus.ErrorCount)return DevExpress.ui.notify(o.errorStatus.wd_Error_MSG,"error",4e3),!(r.spinner=!0);t(function(){DevExpress.ui.notify("DocID: "+m.DocId+" checked in 'SUCCESSFULLY'!","success",4e3),r.listOptions[0].I="0",r.spinner=!0,r.cancelPanel()},5e3)},function(e){n.setMessage("DocID: "+m.DocId+" 'FAILED' to checked in!","error"),l.log(e),i.reload()})},r.checkOutBtn={text:"Check Out",type:"success",onClick:function(e){}},r.download=function(n){r.dwnSpinner=!1,d.download(n).then(function(i){var e=i.data.download;""!=e.errorStatus.ErrorCount?DevExpress.ui.notify(e.errorStatus.wd_Error_MSG,"error",4e3):e.message?DevExpress.ui.notify(e.message,"error",4e3):-1!=f.indexOf("Frowser")?d.getFolderLevel().then(function(e){for(var o=0;o<e.data.root.Cabinets.length;o++)if(e.data.root.Cabinets[o].pgID==n.profileGroupId){var t=e.data.root.Cabinets[o].pgFields.split("|");return r.getResponse(i.data,n,t),!1}},function(e){l.error(e),DevExpress.ui.notify("IIS error 500","error",4e3)}):c.location.href=a.host+i.data.download.fileLoc,r.dwnSpinner=!0},function(e){l.error(e),r.dwnSpinner=!0,DevExpress.ui.notify("IIS error 500","error",4e3)})},r.getResponse=function(e,o,t){var i=e.download.FileZMS.replace(/\\/g,"\\\\");t.shift();for(var n=0;n<t.length;n++)""!==t[n]?t[n]=o["Field"+(n+1)]:t[n]="";c.location.href=a.host+"/cgi-bin/wdwebcgi.exe?SERVE+wd_SID="+a.userData.session+"+html=/api/apiList.json+dwLoc="+e.download.fileLoc+"+name="+e.download.FileNme+"+domain="+a.host+"+cabinet="+o.profileGroupId+"+f1="+t[0]+"+f2="+t[1]+"+f3="+t[2]+"+f4="+t[3]+"+f5="+t[4]+"+f6="+t[5]+"+f7="+t[6]+"+popFlag="+r.softpopFlag+"+zms="+i},r.fileUpload={uploadUrl:a.host+a.uploadLocation,bindingOptions:{multiple:"multiple",accept:"accept",value:"value",uploadMode:"uploadMode"},onValueChanged:function(e){if(0===e.value.length)return h.name="",!1;r.value=e.value,h.name=e.value[0].name}},r.profileBtn="",r.commentData={bindingOptions:{formData:"getComment",readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,colCount:1,validationGroup:"comment"},items:[{itemType:"group",items:[{colSpan:1,dataField:"Comment",editorType:"dxTextArea",editorOptions:{height:90},label:{text:"Comment:"}}]}]},r.commentBtn={text:"Add Comment",type:"success",useSubmitBehavior:!0,validationGroup:"comment"},r.closeEdit=function(){r.profileType=!1,r.profileBtn=""},r.updateProfile={bindingOptions:{text:"profileBtn"},type:"success",useSubmitBehavior:!0}}]);