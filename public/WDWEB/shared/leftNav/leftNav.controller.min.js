angular.module("WDWeb").controller("leftNavCtrl",["$scope","$rootScope","$log","$location","wdService","homeService","leftNavService","$timeout","$localStorage",function(o,i,t,e,n,r,s,c,d){o.cabinets=[],o.menuUpdate="#bmkContainer",o.leftNavColumn=!0,o.date="Rev: 155058.7724",o.textValue="",o.$on("setLeftSize",function(){o.openMenu()}),o.checkBoxSettingNav={bookmarks:{value:!0,width:180,text:"Bookmarks"},favmatters:{value:!0,width:180,text:"Fav Matters"},workspaces:{value:!0,width:180,text:"Workspaces"},cabinets:{value:!0,width:180,text:"Cabinets"},favorites:{value:!0,width:180,text:"Favorites"}},i.$watch("$root.showElements",function(e){e&&(o.server="Server: "+d.serverName,o.setLeftNav())}),o.$on("closeAllPanel",function(e,t){o.selectedTab=""}),o.setLeftNav=function(){i.leftMenuAction=!0,r.checkLocalStorage(),o.openedTab=[],o.spinners={bookmarks:!1,favorites:!1,matters:!1,cabinets:!1,workspaces:!1},s.iniData("VtabTree","1").then(function(e){var t=e.data.root;if(""!==t.Header.ErrorCount)return DevExpress.ui.notify(t.Header.wd_Error_MSG,"error",4e3),o.leftNavColumn=!1;if(d.CategoryMenu)o.navOrder=d.CategoryMenu,o.leftNavColumn=!1;else for(var a=0;a<t.items.length;a++){if("Seq"===t.items[a].K){for(var n=t.items[a].D.split(";"),r=0;r<n.length;r++)"MC"!==n[r]&&"WF"!==n[r]||n.splice(r,1);return n.push("ST"),o.navOrder=n,!1}o.navOrder=["FF","FM","PG","WS","BM","ST"],o.leftNavColumn=!1}},function(e){t.error(e)});o.getCabinetlist={bindingOptions:{items:"$parent.$parent.cabinets"},height:400,dataStructure:"plain",displayExpr:"Desc",onItemClick:function(e){i.$broadcast("cabinetEvent",{data:!0})}}},o.setResizable={width:200,minWidth:44,maxWidth:300,handles:"right",onResize:function(e){var t=e.model.$parent.$$childTail.wdView,a=parseInt(window.innerWidth)-parseInt(e.width),n=$("#leftNav").dxResizable("instance");if($("#wdCabinetPanel, #wdFavMatterPanel, #wdWorkspacePanel, #actionBtnList").css("left",n.option("width")),t){e.width;var r=parseInt(window.innerWidth)-parseInt(e.width);a=r-parseInt($("#homeFileMenu").css("width"));i.appMax=r,i.appWidth=r,i.gridMax=a,i.gridWidth=a}else i.appMax=a,i.appWidth=a,i.gridMax=a,i.gridWidth=a,$("#gridContainer").css("maxWidth",a);if(setTimeout(function(){angular.element('#homedataGrid div[dx-toolbar="fileActionToolbar"]').dxToolbar("instance")._windowResizeCallBack()},500),44==e.width)return o.selectedTab="",i.leftMenuAction=!1;i.leftMenuAction=!0},onResizeStart:function(e){e.element.find(".dx-resizable-handle-right").css("background-color","#224e6e")},onResizeEnd:function(e){e.element.find(".dx-resizable-handle-right").removeAttr("style")}},o.leftMenuView={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always"},o.openMenu=function(){o.$parent.$$childTail.wdView;var e="",t="";i.$broadcast("cabinetEvent",{show:!1,data:"",pgID:""}),o.selectedTab="",e=i.leftMenuAction?(t=200,parseInt(window.innerWidth)-parseInt(200)):(t=44,parseInt(window.innerWidth)-parseInt(44)),o.setBoWidth(e,t)},i.$on("openMenuFMC",function(){i.leftMenuAction=!1,i.$broadcast("cabinetEvent",{show:!1,data:"",pgID:""}),o.selectedTab=""}),o.gohome=function(){e.path("/landing").search({})},o.navAction=function(e){o.fav="",o.cabFilter="",o.wkSpaces="",o.fvMatter="";o.bkMarks="";if(o.getNavData(e),o.selectedTab!=e&&i.$broadcast("closeAllPanel"),o.selectedTab=e,o.openedTab.push(o.selectedTab),!i.leftMenuAction){var t=parseInt(window.innerWidth)-parseInt(200);o.setBoWidth(t,200)}i.leftMenuAction=!0},o.setNewHeightScroll=function(e){if("favorites"===e){var t=angular.element("#dxScrollFavorites").height();$("#dxScrollFavorites").dxScrollView("instance").option("height",parseInt(t)+parseInt(10))}else if("bookmark"===e){t=angular.element("#dxScrollBookmarks").height();$("#dxScrollBookmarks").dxScrollView("instance").option("height",parseInt(t)+parseInt(10))}else if("matters"===e){t=angular.element("#dxScrollFavMatters").height();$("#dxScrollFavMatters").dxScrollView("instance").option("height",parseInt(t)+parseInt(10))}else if("cabinets"===e){t=angular.element("#dxScrollCabinates").height();$("#dxScrollCabinates").dxScrollView("instance").option("height",parseInt(t)+parseInt(10))}else{t=angular.element("#dxScrollWorkspaces").height();$("#dxScrollWorkspaces").dxScrollView("instance").option("height",parseInt(t)+parseInt(10))}},o.setBoWidth=function(e,t){if(o.$parent.$$childTail.wdView){var a=parseInt(getWidth)-parseInt($("#homeFileMenu").css("width"));$("#leftNav").css("width",t),$("#homedataGrid").css("width",a).css("maxWidth",a),$("#appBody").css("width",getWidth).css("maxWidth",getWidth),i.appMax=getWidth,i.appWidth=getWidth,i.gridMax=a,i.gridWidth=a}else i.appMax=e,i.appWidth=e,i.gridMax="",i.gridWidth="",$("#leftNav").css("width",t),$("#appBody").css("width",e),$("#gridContainer").css("maxWidth",e)},o.showSpinner=!0,o.getNavData=function(a){"favorites"===a?s.favorites().then(function(e){if(""!==e.data.root.Header.ErrorCount)return o.ffMessage="Favorites failed to load!",!(o.spinners.favorites=!0);""===e.data.root.Favorites?o.ffMessage="No Favorite files found!":(o.ffMessage="",void 0===e.data.root.Favorites.length?(arr=[],arr.push(e.data.root.Favorites),o.favorites=arr):(o.favorites=e.data.root.Favorites,i.$broadcast("setAnchor",{data:e.data.root.Favorites[0]}))),c(function(){o.spinners={bookmarks:!1,favorites:!0,matters:!1,cabinets:!1,workspaces:!1}},1e3),c(function(){o.setNewHeightScroll(a)},1100)},function(e){o.spinners.favorites=!0,console.log(e)}):"bookmark"===a?s.bookmarks().then(function(e){if(""!==e.data.root.Header.ErrorCount)return o.bmkMessage="Bookmarks failed to load!",!(o.spinners.bookmarks=!0);""===e.data.root.Bookmarks?o.bmkMessage="No Bookmarks found!":(o.bmkMessage="",void 0===e.data.root.Bookmarks.length?(arr=[],arr.push(e.data.root.Bookmarks),o.bookmarks=arr):(o.bookmarks=e.data.root.Bookmarks,i.$broadcast("setAnchor",{data:e.data.root.Bookmarks[0]}))),c(function(){o.spinners={bookmarks:!0,favorites:!1,matters:!1,cabinets:!1,workspaces:!1}},1e3),c(function(){o.setNewHeightScroll(a)},1100)},function(e){o.spinners.bookmarks=!0,t.error(e)}):"matters"===a?s.favMatters().then(function(e){if(""!==e.data.root.Header.ErrorCount)return o.favMMessage="Favorite Matters failed to load!",!(o.spinners.matters=!0);""===e.data.root.FavMatters?(o.favMMessage="No Favorite Matters found!",r.setMatterList(null)):(o.favMMessage="",void 0===e.data.root.FavMatters.length?(arr=[],arr.push(e.data.root.FavMatters),o.favMatters=arr):(o.favMatters=e.data.root.FavMatters,o.mainNavfavMatters=e.data.root.FavMatters.filter(function(t,e,a){return a.indexOf(_.find(a,function(e){return e.szPGID==t.szPGID}))==e}),i.$broadcast("setAnchor",{data:e.data.root.FavMatters[0]}))),c(function(){o.spinners={bookmarks:!1,favorites:!1,matters:!0,cabinets:!1,workspaces:!1}},1e3),c(function(){o.setNewHeightScroll(a)},1100)},function(e){o.spinners.matters=!0,console.log(e)}):"cabinets"===a?s.cabinets().then(function(e){if(""!==e.data.root.Header.ErrorCount)return o.cabMessage="Cabinets failed to load!",!(o.spinners.cabinets=!0);""===e.data.root.Cabinets?o.cabMessage="No Cabinets found!":(o.cabMessage="",void 0===e.data.root.Cabinets.length?(arr=[],arr.push(e.data.root.Cabinets),o.cabinets=arr):o.convertInt(e.data.root.Cabinets)),c(function(){o.spinners={bookmarks:!1,favorites:!1,matters:!1,cabinets:!0,workspaces:!1}},1e3),c(function(){o.setNewHeightScroll(a)},1100)},function(e){o.spinners.cabinets=!0,console.log(e)}):s.workspaces(null,null,null).then(function(e){var t=e.data.root;if(""!==t.Header.ErrorCount)return o.wkMessage="Workspaces failed to load!",!(o.spinners.workspaces=!0);d.wdWorkSpaceID&&n.clearListfromParm(d.wdWorkSpaceID).then(function(e){console.log(e)}),""===t.items?o.wkMessage="No Workspaces found!":(o.wkMessage="",void 0===t.items.length?(arr=[],arr.push(t.items),o.workspaces=arr):(o.workspaces=t,i.$broadcast("setAnchor",{data:t.items[0]}))),o.spinners={bookmarks:!1,favorites:!1,matters:!1,cabinets:!1,workspaces:!0},d.wdWorkSpaceID=t.Header.List_ID,o.setNewHeightScroll(a)},function(e){o.spinners.workspaces=!0,console.log(e)})},o.convertInt=function(e){o.cabinets=e,i.$broadcast("setAnchor",{data:e[0]});for(var t=0;t<e.length;t++)o.cabinets[t].parentId=parseInt(e[t].parentId)},o.visiblePopup=!1,o.popupTreeTabsOptions={width:280,height:400,contentTemplate:"info",showTitle:!0,title:"Configure Tree Tabs",closeOnOutsideClick:!1,dragEnabled:!0,bindingOptions:{visible:"visiblePopup"}},o.showInfo=function(e){o.currentEmployee=e.model.employee,o.visiblePopup=!0},o.showSettingNaveMenu=function(){o.visiblePopup=!0,setTimeout(function(){d.CategorySetting?($("#hdd-navOrderSetting").val(d.CategorySetting.join(", ")),o.navOrderSetting=$("#hdd-navOrderSetting").val().split(", ")):o.navOrderSetting=["FF","FM","PG","WS","BM"]},100),setTimeout(function(){-1==o.navOrder.indexOf("FF")?$("#ckc-st-favorites").dxCheckBox("instance").option("value",!1):$("#ckc-st-favorites").dxCheckBox("instance").option("value",!0),-1==o.navOrder.indexOf("FM")?$("#ckc-st-favmatters").dxCheckBox("instance").option("value",!1):$("#ckc-st-favmatters").dxCheckBox("instance").option("value",!0),-1==o.navOrder.indexOf("PG")?$("#ckc-st-cabinets").dxCheckBox("instance").option("value",!1):$("#ckc-st-cabinets").dxCheckBox("instance").option("value",!0),-1==o.navOrder.indexOf("WS")?$("#ckc-st-workspaces").dxCheckBox("instance").option("value",!1):$("#ckc-st-workspaces").dxCheckBox("instance").option("value",!0),-1==o.navOrder.indexOf("BM")?$("#ckc-st-bookmaps").dxCheckBox("instance").option("value",!1):$("#ckc-st-bookmaps").dxCheckBox("instance").option("value",!0)},1e3)},o.saveSettingNav=function(){o.visiblePopup=!1,o.navOrder=[];for(var e=0;e<o.navOrderSetting.length;e++)"FF"==o.navOrderSetting[e]&&$("#ckc-st-favorites").dxCheckBox("instance").option("value")&&o.navOrder.push("FF"),"FM"==o.navOrderSetting[e]&&$("#ckc-st-favmatters").dxCheckBox("instance").option("value")&&o.navOrder.push("FM"),"PG"==o.navOrderSetting[e]&&$("#ckc-st-cabinets").dxCheckBox("instance").option("value")&&o.navOrder.push("PG"),"WS"==o.navOrderSetting[e]&&$("#ckc-st-workspaces").dxCheckBox("instance").option("value")&&o.navOrder.push("WS"),"BM"==o.navOrderSetting[e]&&$("#ckc-st-bookmaps").dxCheckBox("instance").option("value")&&o.navOrder.push("BM");o.navOrder.push("ST"),d.CategoryMenu=o.navOrder,d.CategorySetting=$("#hdd-navOrderSetting").val().split(", ")},o.upItemMenu=function(e){for(var t=0;t<o.navOrderSetting.length;t++)if(o.navOrderSetting[t]==e){var a=o.navOrderSetting[t-1];return o.navOrderSetting[t-1]=e,void(o.navOrderSetting[t]=a)}},o.downItemMenu=function(e){for(var t=0;t<o.navOrderSetting.length;t++)if(o.navOrderSetting[t]==e){var a=o.navOrderSetting[t+1];return o.navOrderSetting[t+1]=e,void(o.navOrderSetting[t]=a)}},i.checkOverleftNav=!1,i.checkOverFavMat=!1,i.checkOverCab=!1,i.checkOverAddSear=!1,i.checkOverDirAcc=!1,i.checkOverUpload=!1,i.checkOverTop=!1,i.checkOverLanding=!1,i.checkOverGrid=!1,$("#leftNav").mouseover(function(e){i.checkOverleftNav=!0}),$("#leftNav").mouseout(function(e){i.checkOverleftNav=!1}),$("#wdFavMatterPanel").mouseover(function(e){i.checkOverFavMat=!0}),$("#wdFavMatterPanel").mouseout(function(e){i.checkOverFavMat=!1}),$("#wdCabinetPanel").mouseover(function(e){i.checkOverCab=!0}),$("#wdCabinetPanel").mouseout(function(e){i.checkOverCab=!1}),$("#wdxCanvasHeader").mouseover(function(e){i.checkOverTop=!0}),$("#wdxCanvasHeader").mouseout(function(e){i.checkOverTop=!1}),$(window).keydown(function(e){var t=o.checkFocusInput();if((e.ctrlKey||e.metaKey)&&70===e.keyCode||0!==e.which&&t)if(i.checkOverleftNav&&null!=o.selectedTab)switch(o.selectedTab){case"favorites":$("#leftNavFilterFF input").focus();break;case"bookmark":$("#leftNavFilterBM input").focus();break;case"matters":$("#leftNavFilterFM input").focus();break;case"cabinets":$("#leftNavFilterPG input").focus();break;case"workspaces":$("#leftNavFilterWS input").focus()}else if(i.checkOverFavMat)$("#wdFilterFavMatter input").focus();else if(i.checkOverCab)$("#wdFilterCabinet input").focus();else if(i.checkOverAddSear&&!$("#popupformtest").is(":visible")){var a=!0;$("#phxTemplate form input").each(function(){$(this).is(":focus")&&(a=!1)}),$("#phxTemplate form textarea").each(function(){$(this).is(":focus")&&(a=!1)}),a&&$("#wdFilterTemplate input").focus()}else if(i.checkOverDirAcc){a=!0;$("#formDirectAccess form input").each(function(){$(this).is(":focus")&&(a=!1)}),a&&$("#wdFilterDirectAccess input").focus()}else if(i.checkOverUpload){a=!0;$("#pxpUploadForm form input").each(function(){$(this).is(":focus")&&(a=!1)}),$("#pxpUploadForm form textarea").each(function(){$(this).is(":focus")&&(a=!1)}),a&&$("#filterUpdate").focus()}else i.checkOverTop?null!=$("#gridContainer").html()?(console.log("Forcus to top"),$("#searchTxtInput input").focus()):$("#searchLanding input").focus():null!=$("#gridContainer").html()?i.checkOverGrid&&$("#gridContainer #wdFilterBox input").focus():i.checkOverLanding&&$("#searchLanding input").focus()}),o.checkFocusInput=function(){var e=!0;return $("#leftNav input").each(function(){$(this).is(":focus")&&(e=!1)}),($("#searchLanding input").is(":focus")||$("#searchTxtInput input").is(":focus"))&&(e=!1),$("#gridContainer .dx-texteditor-input").is(":focus")&&(e=!1),e}}]);