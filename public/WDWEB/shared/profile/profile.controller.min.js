<<<<<<< HEAD
"use strict";angular.module("WDWeb").controller("profileCtrl",["$scope","$timeout","$log","$route","uxService","profileService","wdService","$rootScope","panelTitleService","fileListUI","homeService","$localStorage","$window",function(c,o,e,t,l,u,a,d,n,r,s,f,F){c.showEditForm=!0,c.wdEdit=!0;var p,m={field1:{value:c.textValue=""},field2:{value:""},field3:{value:""},field4:{value:""},field5:{value:""},field6:{value:""},field7:{value:""}};function h(){var t=[];return n.getCabinetList().then(function(e){if(""!==e.data.root.Header.ErrorCount)return DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;for(i=0;i<e.data.root.Cabinets.length;i++)t.push(e.data.root.Cabinets[i])},function(e){console.log(e)}),t}c.showTableLoader=!1,c.fieldListData=[],c.wdFilterBox={placeholder:"Filter",elementAttr:{id:"wdFilterProfile"},onEnterKey:function(e){c.showTableLoader=!1,c.showEditForm=!1,c.textValue=e.event.target.value,c.searchFt()},showClearButton:!0},c.wdFilterSideBtn={icon:"ms-Icon ms-Icon--Accept",onClick:function(e){c.showTableLoader=!1,c.showEditForm=!1;var i=$("#wdFilterProfile").dxTextBox("instance");c.textValue=i.option("value"),c.searchFt()},elementAttr:{class:"wdFilterSideBtn"}},angular.element(F).bind("resize",function(){angular.forEach(["#editForm","#scrollTables"],function(e,i){void 0!==$(e).dxScrollView("instance")&&$(e).dxScrollView("instance").option("height",window.innerHeight-290)})}),c.$on("clearFieldTable",function(){c.wdEdit=!0}),c.setFlag=!0,c.scrollProfile={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-250},useNative:!0},c.$watch(function(){return s.getSelectedList()},function(e){c.showEditForm=!0;var i=null;if(c.setFlag=!0,1==e.length)c.chkSecurity(e),c.showTagField=!0,c.editFields.comment="",c.descCommFlag=!1,c.setDescComm(e),""!==e[0].Comments&&""!==e[0].Description?(c.checkDescCommFlag=!0,c.checkDescFlag=!1):(c.checkDescFlag=!0,c.checkDescCommFlag=!1),c.checkCommFlag=!1,c.editFields.description=e[0].Description,c.checkCommFlag=!1,c.setFlag=!1,i=e[0].profileGroupId+"|"+(void 0===e[0].Field1Name?"":e[0].Field1Name)+"|"+(void 0===e[0].Field2Name?"":e[0].Field2Name)+"|"+(void 0===e[0].Field3Name?"":e[0].Field3Name)+"|"+(void 0===e[0].Field4Name?"":e[0].Field4Name)+"|"+(void 0===e[0].Field5Name?"":e[0].Field5Name)+"|"+(void 0===e[0].Field6Name?"":e[0].Field6Name)+"|"+(void 0===e[0].Field7Name?"":e[0].Field7Name)+"|";else if(1<e.length){var t=e[e.length-1];c.showTagField=!1,c.checkCommFlag=!0,c.checkDescFlag=!1,c.checkDescCommFlag=!1,c.editFields.description="",c.editFields.comment="",c.descCommFlag=!0,i=t.profileGroupId+"|"+(void 0===t.Field1Name?"":t.Field1Name)+"|"+(void 0===t.Field2Name?"":t.Field2Name)+"|"+(void 0===t.Field3Name?"":t.Field3Name)+"|"+(void 0===t.Field4Name?"":t.Field4Name)+"|"+(void 0===t.Field5Name?"":t.Field5Name)+"|"+(void 0===t.Field6Name?"":t.Field6Name)+"|"+(void 0===t.Field7Name?"":t.Field7Name)+"|"}o(function(){c.pgCabinetValue=i,c.setFields(e)},1e3)}),c.maxcount=500,c.indexFr=0,c.pgIdValue="",c.checkFt=!1,c.securityValue="",c.listOfTags=[],c.tagValues=[],c.chkSecurity=function(e){"52"==e[0].I?c.securityValue=8:"51"==e[0].I?c.securityValue=16:c.securityValue=""},c.setFieldTableOrder=function(e){for(var i=[],t=1;t<=7;t++)if(e.hasOwnProperty("f"+t+"n")){var l=e["f"+t+"n"]+" ("+e["f"+t+"d"]+")";i.push(l)}return i.reverse().join(" - ")},c.wdSecurity=[{name:"None",value:""},{name:"Hidden",value:16},{name:"Protected",value:8}],c.editProfile={Cabinets:{dataSource:h(),placeholder:"Cabinet",valueExpr:"pgFields",displayExpr:"pgName",width:"100%",bindingOptions:{value:"pgCabinetValue"},onValueChanged:function(e){c.pgCabinetValue=e.value;var i=e.value.split("|");u.setDesc({desc1:"",desc2:"",desc3:"",desc4:"",desc5:"",desc6:"",desc7:""});for(var t=1;t<=7;t++)""!==i[t]?(c.fieldContainer["Field"+t]=!0,c.editFields["placeholder"+t]=i[t]):c.fieldContainer["Field"+t]=!1,c.editFields["field"+t]="";c.editFields.description="",c.editFields.comment="",null==e.event&&c.setFields()},itemTemplate:function(e){return"<div class='custom-item'>"+e.pgName+"</div>"}},field1:{bindingOptions:{value:"editFields.field1",placeholder:"editFields.placeholder1"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field2:{bindingOptions:{value:"editFields.field2",placeholder:"editFields.placeholder2"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field3:{bindingOptions:{value:"editFields.field3",placeholder:"editFields.placeholder3"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field4:{bindingOptions:{value:"editFields.field4",placeholder:"editFields.placeholder4"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field5:{bindingOptions:{value:"editFields.field5",placeholder:"editFields.placeholder5"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field6:{bindingOptions:{value:"editFields.field6",placeholder:"editFields.placeholder6"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field7:{bindingOptions:{value:"editFields.field7",placeholder:"editFields.placeholder7"},width:140,onFocusOut:function(e){c.focusOutField(e)}},security:{placeholder:"Security",dataSource:c.wdSecurity,valueExpr:"value",displayExpr:"name",width:200,bindingOptions:{value:"securityValue"},onValueChanged:function(e){c.securityValue=e.value}},tags:{bindingOptions:{dataSource:"listOfTags",value:"tagValues"},displayExpr:"CD",itemTemplate:"customTagItem",onValueChanged:function(e){c.tagValues=e.value}},descComm:{bindingOptions:{value:"editFields.descComm"},width:"100%",height:"90px"},description:{bindingOptions:{value:"editFields.description"},width:"100%",placeholder:c.editFields.placeholderDesc},comment:{bindingOptions:{value:"editFields.comment"},width:"100%",placeholder:c.editFields.placeholderCo}},c.setFields=function(s){cabinetList=h(),o(function(){for(var e,l={desc1:"",desc2:"",desc3:"",desc4:"",desc5:"",desc6:"",desc7:""},i=c.myFileList.slice(-1).pop(),t=[],d=0;d<c.myFileList.length;d++)for(var o=0;o<7;o++)e=parseInt(o)+parseInt(1),t[o]?t[o].code!==c.myFileList[d]["Field"+e]?(t[o].code="*",t[o].count++):t[o].code=c.myFileList[d]["Field"+e]:(t[o]={},t[o].code=c.myFileList[d]["Field"+e],t[o].count=1),t[o].desc=c.myFileList[d]["Field"+e+"Desc"],t[o].name=c.myFileList[d]["Field"+e+"Name"],t[o].field="field"+e;if(u.setDesc(l),void 0!==i){for(var a=0;a<cabinetList.length;a++)if(i.profileGroupId==cabinetList[a].pgID){for(var n=c.pgCabinetValue.split("|"),r=1;r<=7;r++)""!=n[r]?(c.fieldContainer["Field"+r]=!0,c.editFields["placeholder"+r]=n[r]):c.fieldContainer["Field"+r]=!1;angular.forEach(t,function(e,i){var t=parseInt(i)+parseInt(1);""!=e.name&&(c.editFields["field"+t]=e.code,l["desc"+t]=e.desc)})}c.setFlag||c.updateProfileList(!1,s),c.showEditForm=!1}},1e3)},c.focusOutField=function(e){for(var i={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},t=1;t<8;t++)null==$("#field"+t).dxTextBox("instance")?i["field"+t]="":i["field"+t]=$("#field"+t).dxTextBox("instance").option("value");var l=e.element[0].id.split("field")[1];a.getFieldDes(c.pgCabinetValue.split("|")[0],i,l).then(function(e){var i=e.data.data.fields;u.setDesc({desc1:i.field1,desc2:i.field2,desc3:i.field3,desc4:i.field4,desc5:i.field5,desc6:i.field6,desc7:i.field7})},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},c.updateProfileList=function(t,l){var e={Cabinets:c.pgCabinetValue};a.checkProfile(e,c.editFields).then(function(e){var i=e.data;return""!=i.Header.ErrorCount?(c.showDetails(i),p.option("visible",!1),!1):t?(c.profileSuccess(),!1):void(void 0!==l&&c.setCategoryList(i.Profile.wdPath,l))},function(e){console.log(e)})},c.showDetails=function(e){var i=e.Profile.Fields;c.descField={desc1:i.Field1.wd_File_Field_Desc,desc2:i.Field2.wd_File_Field_Desc,desc3:i.Field3.wd_File_Field_Desc,desc4:i.Field4.wd_File_Field_Desc,desc5:i.Field5.wd_File_Field_Desc,desc6:i.Field6.wd_File_Field_Desc,desc7:i.Field7.wd_File_Field_Desc};for(var t=1;t<=7;t++)""!==i["Field"+t].wd_File_Field_Error?c["wdFieldColor"+t]="#a80000":c["wdFieldColor"+t]="#107c10"},c.setCategoryList=function(e,t){c.tagValues=[];var i=decodeURIComponent(e),d=[];r.getCategoryList(i).then(function(e){var i=e.data.root;if(""!==i.Header.Error_Count)return DevExpress.ui.notify(i.Header.Error_Msg,"error",4e3),!1;c.listOfTags=i.Items;var l=t[0].CAT_ID;c.catList=t[0],""!==l&&angular.forEach(c.listOfTags,function(t,e){angular.forEach(l,function(e,i){t.CN===e.CN&&d.push(t)})}),c.tagValues=d,c.oriTagValue=angular.copy(c.tagValues)},function(e){DevExpress.ui.notify("IIS Error","error",4e3)})},c.setSelectMenu=function(e){c.selected=e},c.isActive=function(e){return c.selected===e},c.profileSuccess=function(){var e,t=$("#editProfileBtn").dxButton("instance");$("#gridContainer").dxDataGrid("instance");e="Copy"==t.option().text?16:8;var i=parseInt(64)+e,l={field1:{value:c.editFields.field1?c.editFields.field1:""},field2:{value:c.editFields.field2?c.editFields.field2:""},field3:{value:c.editFields.field3?c.editFields.field3:""},field4:{value:c.editFields.field4?c.editFields.field4:""},field5:{value:c.editFields.field5?c.editFields.field5:""},field6:{value:c.editFields.field6?c.editFields.field6:""},field7:{value:c.editFields.field7?c.editFields.field7:""},security:c.securityValue,desc:encodeURIComponent(c.editFields.descComm),comm:encodeURIComponent(c.editFields.comment),wdRename:i,cabinet:c.pgCabinetValue.split("|")[0]};angular.forEach(s.getSelectedList(),function(e,i){i=void 0===i?0:i,a.updateProfile(l,e).then(function(e){var i=e.data.fileStatus;if(""!==i.errorStatus.ErrorCount)return c.errortype(i,t.option().text),p.option("visible",!1),!1;c.delCats()},function(e){DevExpress.ui.notify("Server Error!","error",4e3)})})},c.delCats=function(){var i=$("#gridContainer").dxDataGrid("instance");if(0!==c.oriTagValue.length){a.setCats("+wd_FILE_CAT_DEL_VALUE=*",c.catList).then(function(e){if(""!==e.data.category.errorStatus.ErrorCount)return p.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh(),!1;c.addCats()},function(e){p.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()})}else c.addCats()},c.addCats=function(){var i=$("#gridContainer").dxDataGrid("instance");if(0!==c.tagValues.length){for(var e="",t=0;t<c.tagValues.length;t++)e=e+"+wd_FILE_CAT_ADD_VALUE["+t+"]="+c.tagValues[t].CN;a.setCats(e,c.catList).then(function(e){p.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()},function(e){p.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()})}else p.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()},c.errortype=function(e,i){var t;if(""!==e.errorStatus.wd_Error_DOCID)return t={title:e.errorStatus.wd_Error_DOCID,desc:e.errorStatus.wd_Error_DOCNAME,wdMsg:e.errorStatus.wd_Error_MSG,status:"failed",type:!1,action:i},d.$broadcast("setDialogStatus",t),p.option("visible",!1),!1;t={wdMsg:e.errorStatus.wd_Error_MSG,status:"failed",type:!0,action:i},d.$broadcast("setDialogStatus",t),p.option("visible",!1)},c.searchFt=function(){c.fieldListData="",c.fieldTableSpin=!1,o(function(){c.getFieldTables(c.fieldNum,c.fieldTableTitle,!0)},1e3)},c.filterLabelTable=function(){c.showTableLoader=!1,o(function(){c.showTableLoader=!0},1e3)},c.wdEdit=!0,c.updateProfile={bindingOptions:{text:"profileBtn"},type:"success",useSubmitBehavior:!0,template:function(e,i){$("<div class='button-indicator'></div><span class='dx-button-text'>"+e.text+"</span>").appendTo(i),p=i.find(".button-indicator").dxLoadIndicator({visible:!1,width:16,height:16}).dxLoadIndicator("instance")},onClick:function(e){p.option("visible",!0)}},c.getComment={Comment:""},c.scrollTables={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-290},useNative:!0},c.getFieldTables=function(t,e,l,d){c.fieldTableTitle=e,c.showTableLoader=!1,c.wdEdit=!1,o(function(){for(var e=1;e<8;e++)null==$("#field"+e).dxTextBox("instance")?m["field"+e].value="":m["field"+e].value=$("#field"+e).dxTextBox("instance").option("value");c.fieldNum=t;var i=c.pgCabinetValue.split("|")[0];a.fieldTables(i,m,c.fieldNum,c.maxcount,c.indexFr,l,c.textValue).then(function(e){if(c.total=e.data.root.Header.ListCount,c.listlength=e.data.root.FieldTbl.length,""!=e.data.root.Header.ErrorCount)return c.showTableLoader=!0,DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;if(c.closeList(e.data.root),d){var i=c.fieldListData.concat(e.data.root.FieldTbl);c.listlength=i.length,c.fieldListData=i}else c.fieldListData=e.data.root.FieldTbl;c.total>c.maxcount?(c.moreTables=!0,c.checkFt=!0,c.ftCount=" "+c.listlength+" of "+c.total):("1"==c.total?c.ftCount=" 1 of 1":c.ftCount=" "+c.total+" of "+c.total,c.checkFt=!1),c.fieldTableSpin=!0,c.showTableLoader=!0,c.selected=c.fieldListData[0]},function(e){c.fieldTableSpin=!0,DevExpress.ui.notify("Server Error!","error",4e3)})},1e3)},c.closeList=function(e){var i=e.Header.List_ID;if(!f.ftListId)return f.ftListId=i,!1;a.clearListfromParm(f.ftListId).then(function(e){f.ftListId=i},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},c.loadMore={text:"Load More",type:"success",useSubmitBehavior:!1,onClick:function(){c.indexFr=+c.indexFr+(c.maxcount+1),c.getFieldTables(c.fieldNum,c.fieldTableTitle,!1,!0)}},c.setField=function(e){for(i=1;i<=7;i++)e["f"+i+"n"]&&($("#field"+i).dxTextBox("instance").option("value",e["f"+i+"n"]),c.descField["desc"+i]=e["f"+i+"d"]);c.fieldListData.length=0,c.wdEdit=!0},c.getToolTip=function(e){var t="";for(i=1;i<=7;i++)e["f"+i+"n"]&&(t+=t=e["f"+i+"n"]+" - "+e["f"+i+"d"]+" | ");return t.substring(0,t.length-2)},c.commentData={bindingOptions:{formData:"getComment",readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,colCount:1,validationGroup:"comment"},items:[{itemType:"group",items:[{colSpan:1,dataField:"Comment",editorType:"dxTextArea",editorOptions:{height:90},label:{text:"Comment:"}}]}]},c.commentBtn={text:"Add Comment",type:"success",useSubmitBehavior:!0,validationGroup:"comment"},c.tagList=a.getFileData().tags,c.$watch(function(){return a.getFileData()},function(e){c.tagList=e.tags}),c.$watch(function(){return u.getDesc()},function(e){c.descField=e}),c.setDescComm=function(e){if(void 0!==e[0].Comments&&""!==e[0].Description)return c.editFields.descComm=e[0].Description+"\r\n\r\n"+e[0].Comments,!1;c.editFields.descComm=e[0].Description},c.btnCancelProfile="Cancel",c.cancelProfilebtn={bindingOptions:{text:"btnCancelProfile"},type:"success",useSubmitBehavior:!0,onClick:function(e){c.fieldListData.length=0,c.wdEdit=!0}}}]);
=======
"use strict";angular.module("WDWeb").controller("profileCtrl",["$scope","$timeout","$log","$route","uxService","profileService","wdService","$rootScope","panelTitleService","fileListUI","homeService","$localStorage","$window",function(c,o,e,t,l,u,n,d,a,r,s,f,p){c.showEditForm=!0,c.wdEdit=!0;var F,m={field1:{value:""},field2:{value:""},field3:{value:""},field4:{value:""},field5:{value:""},field6:{value:""},field7:{value:""}};function h(){var t=[];return a.getCabinetList().then(function(e){if(""!==e.data.root.Header.ErrorCount)return DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;for(i=0;i<e.data.root.Cabinets.length;i++)t.push(e.data.root.Cabinets[i])},function(e){console.log(e)}),t}c.showTableLoader=!1,c.fieldListData=[],c.wdFilterBox={placeholder:"Filter",elementAttr:{id:"wdFilterProfile"},onEnterKey:function(e){c.fieldTableSpin=!1,c.textValue=e.event.target.value,"ft"==vm.prefillData?vm.searchFt():o(function(){c.fieldTableSpin=!0},1e3)},showClearButton:!0},c.wdFilterSideBtn={icon:"ms-Icon ms-Icon--Accept",onClick:function(e){c.fieldTableSpin=!1;var i=$("#wdFilterProfile").dxTextBox("instance");c.textValue=i.option("value"),"ft"==vm.prefillData?vm.searchFt():o(function(){c.fieldTableSpin=!0},1e3)},elementAttr:{class:"wdFilterSideBtn"}},angular.element(p).bind("resize",function(){angular.forEach(["#editForm","#scrollTables"],function(e,i){void 0!==$(e).dxScrollView("instance")&&$(e).dxScrollView("instance").option("height",window.innerHeight-285)})}),c.$on("clearFieldTable",function(){c.wdEdit=!0}),c.setFlag=!0,c.scrollProfile={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-250},useNative:!0},c.$watch(function(){return s.getSelectedList()},function(e){c.showEditForm=!0;var i=null;if(c.setFlag=!0,1==e.length)c.chkSecurity(e),c.showTagField=!0,c.editFields.comment="",c.descCommFlag=!1,c.setDescComm(e),""!==e[0].Comments&&""!==e[0].Description?(c.checkDescCommFlag=!0,c.checkDescFlag=!1):(c.checkDescFlag=!0,c.checkDescCommFlag=!1),c.checkCommFlag=!1,c.editFields.description=e[0].Description,c.checkCommFlag=!1,c.setFlag=!1,i=e[0].profileGroupId+"|"+(void 0===e[0].Field1Name?"":e[0].Field1Name)+"|"+(void 0===e[0].Field2Name?"":e[0].Field2Name)+"|"+(void 0===e[0].Field3Name?"":e[0].Field3Name)+"|"+(void 0===e[0].Field4Name?"":e[0].Field4Name)+"|"+(void 0===e[0].Field5Name?"":e[0].Field5Name)+"|"+(void 0===e[0].Field6Name?"":e[0].Field6Name)+"|"+(void 0===e[0].Field7Name?"":e[0].Field7Name)+"|";else if(1<e.length){var t=e[e.length-1];c.showTagField=!1,c.checkCommFlag=!0,c.checkDescFlag=!1,c.checkDescCommFlag=!1,c.editFields.description="",c.editFields.comment="",c.descCommFlag=!0,i=t.profileGroupId+"|"+(void 0===t.Field1Name?"":t.Field1Name)+"|"+(void 0===t.Field2Name?"":t.Field2Name)+"|"+(void 0===t.Field3Name?"":t.Field3Name)+"|"+(void 0===t.Field4Name?"":t.Field4Name)+"|"+(void 0===t.Field5Name?"":t.Field5Name)+"|"+(void 0===t.Field6Name?"":t.Field6Name)+"|"+(void 0===t.Field7Name?"":t.Field7Name)+"|"}o(function(){c.pgCabinetValue=i,c.setFields(e)},1e3)}),c.maxcount=500,c.indexFr=0,c.pgIdValue="",c.checkFt=!1,c.securityValue="",c.listOfTags=[],c.tagValues=[],c.chkSecurity=function(e){"52"==e[0].I?c.securityValue=8:"51"==e[0].I?c.securityValue=16:c.securityValue=""},c.setFieldTableOrder=function(e){for(var i=[],t=1;t<=7;t++)if(e.hasOwnProperty("f"+t+"n")){var l=e["f"+t+"n"]+" ("+e["f"+t+"d"]+")";i.push(l)}return i.reverse().join(" - ")},c.wdSecurity=[{name:"None",value:""},{name:"Hidden",value:16},{name:"Protected",value:8}],c.editProfile={Cabinets:{dataSource:h(),placeholder:"Cabinet",valueExpr:"pgFields",displayExpr:"pgName",width:"100%",bindingOptions:{value:"pgCabinetValue"},onValueChanged:function(e){c.pgCabinetValue=e.value;var i=e.value.split("|");u.setDesc({desc1:"",desc2:"",desc3:"",desc4:"",desc5:"",desc6:"",desc7:""});for(var t=1;t<=7;t++)""!==i[t]?(c.fieldContainer["Field"+t]=!0,c.editFields["placeholder"+t]=i[t]):c.fieldContainer["Field"+t]=!1,c.editFields["field"+t]="";c.editFields.description="",c.editFields.comment="",null==e.event&&c.setFields()},itemTemplate:function(e){return"<div class='custom-item' title='"+e.pgName+"' title-direction='top'>"+e.pgName+"</div>"}},field1:{bindingOptions:{value:"editFields.field1",placeholder:"editFields.placeholder1"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field2:{bindingOptions:{value:"editFields.field2",placeholder:"editFields.placeholder2"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field3:{bindingOptions:{value:"editFields.field3",placeholder:"editFields.placeholder3"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field4:{bindingOptions:{value:"editFields.field4",placeholder:"editFields.placeholder4"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field5:{bindingOptions:{value:"editFields.field5",placeholder:"editFields.placeholder5"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field6:{bindingOptions:{value:"editFields.field6",placeholder:"editFields.placeholder6"},width:140,onFocusOut:function(e){c.focusOutField(e)}},field7:{bindingOptions:{value:"editFields.field7",placeholder:"editFields.placeholder7"},width:140,onFocusOut:function(e){c.focusOutField(e)}},security:{placeholder:"Security",dataSource:c.wdSecurity,valueExpr:"value",displayExpr:"name",width:200,bindingOptions:{value:"securityValue"},onValueChanged:function(e){c.securityValue=e.value}},tags:{bindingOptions:{dataSource:"listOfTags",value:"tagValues"},displayExpr:"CD",itemTemplate:"customTagItem",onValueChanged:function(e){c.tagValues=e.value}},descComm:{bindingOptions:{value:"editFields.descComm"},width:"100%",height:"90px"},description:{bindingOptions:{value:"editFields.description"},width:"100%",placeholder:c.editFields.placeholderDesc},comment:{bindingOptions:{value:"editFields.comment"},width:"100%",placeholder:c.editFields.placeholderCo}},c.setFields=function(s){cabinetList=h(),o(function(){for(var e,l={desc1:"",desc2:"",desc3:"",desc4:"",desc5:"",desc6:"",desc7:""},i=c.myFileList.slice(-1).pop(),t=[],d=0;d<c.myFileList.length;d++)for(var o=0;o<7;o++)e=parseInt(o)+parseInt(1),t[o]?t[o].code!==c.myFileList[d]["Field"+e]?(t[o].code="*",t[o].count++):t[o].code=c.myFileList[d]["Field"+e]:(t[o]={},t[o].code=c.myFileList[d]["Field"+e],t[o].count=1),t[o].desc=c.myFileList[d]["Field"+e+"Desc"],t[o].name=c.myFileList[d]["Field"+e+"Name"],t[o].field="field"+e;if(u.setDesc(l),void 0!==i){for(var n=0;n<cabinetList.length;n++)if(i.profileGroupId==cabinetList[n].pgID){for(var a=c.pgCabinetValue.split("|"),r=1;r<=7;r++)""!=a[r]?(c.fieldContainer["Field"+r]=!0,c.editFields["placeholder"+r]=a[r]):c.fieldContainer["Field"+r]=!1;angular.forEach(t,function(e,i){var t=parseInt(i)+parseInt(1);""!=e.name&&(c.editFields["field"+t]=e.code,l["desc"+t]=e.desc)})}c.setFlag||c.updateProfileList(!1,s),c.showEditForm=!1}},1e3)},c.focusOutField=function(e){for(var i={field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""},t=1;t<8;t++)null==$("#field"+t).dxTextBox("instance")?i["field"+t]="":i["field"+t]=$("#field"+t).dxTextBox("instance").option("value");var l=e.element[0].id.split("field")[1];n.getFieldDes(c.pgCabinetValue.split("|")[0],i,l).then(function(e){var i=e.data.data.fields;u.setDesc({desc1:i.field1,desc2:i.field2,desc3:i.field3,desc4:i.field4,desc5:i.field5,desc6:i.field6,desc7:i.field7})},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},c.updateProfileList=function(t,l){var i=function(){var e={Cabinets:c.pgCabinetValue};n.checkProfile(e,c.editFields).then(function(e){var i=e.data;return""!=i.Header.ErrorCount?(c.showDetails(i),!1):t?(c.profileSuccess(),!1):void(void 0!==l&&c.setCategoryList(i.Profile.wdPath,l))},function(e){console.log(e)})};t?n.isFileHasChanged().then(function(e){e?(d.$broadcast("showMessageWhenFileChanged"),setTimeout(function(){$("#btnConfirmCheckFile").on("click",function(e){e.preventDefault(),$("#popupFileChangedOptions").dxPopup().dxPopup("instance").hide(),i()})},200)):i()}):i()},c.showDetails=function(e){var i=e.Profile.Fields;c.descField={desc1:i.Field1.wd_File_Field_Desc,desc2:i.Field2.wd_File_Field_Desc,desc3:i.Field3.wd_File_Field_Desc,desc4:i.Field4.wd_File_Field_Desc,desc5:i.Field5.wd_File_Field_Desc,desc6:i.Field6.wd_File_Field_Desc,desc7:i.Field7.wd_File_Field_Desc};for(var t=1;t<=7;t++)""!==i["Field"+t].wd_File_Field_Error?c["wdFieldColor"+t]="#a80000":c["wdFieldColor"+t]="#107c10"},c.setCategoryList=function(e,t){c.tagValues=[];var i=decodeURIComponent(e),d=[];r.getCategoryList(i).then(function(e){var i=e.data.root;if(""!==i.Header.Error_Count)return DevExpress.ui.notify(i.Header.Error_Msg,"error",4e3),!1;c.listOfTags=i.Items;var l=t[0].CAT_ID;c.catList=t[0],""!==l&&angular.forEach(c.listOfTags,function(t,e){angular.forEach(l,function(e,i){t.CN===e.CN&&d.push(t)})}),c.tagValues=d,c.oriTagValue=angular.copy(c.tagValues)},function(e){DevExpress.ui.notify("IIS Error","error",4e3)})},c.setSelectMenu=function(e){c.selected=e},c.isActive=function(e){return c.selected===e},c.profileSuccess=function(){var e,t=$("#editProfileBtn").dxButton("instance");$("#gridContainer").dxDataGrid("instance");e="Copy"==t.option().text?16:8;var i=parseInt(64)+e,l={field1:{value:c.editFields.field1?c.editFields.field1:""},field2:{value:c.editFields.field2?c.editFields.field2:""},field3:{value:c.editFields.field3?c.editFields.field3:""},field4:{value:c.editFields.field4?c.editFields.field4:""},field5:{value:c.editFields.field5?c.editFields.field5:""},field6:{value:c.editFields.field6?c.editFields.field6:""},field7:{value:c.editFields.field7?c.editFields.field7:""},security:c.securityValue,desc:encodeURIComponent(c.editFields.descComm),comm:encodeURIComponent(c.editFields.comment),wdRename:i,cabinet:c.pgCabinetValue.split("|")[0]};angular.forEach(s.getSelectedList(),function(e,i){i=void 0===i?0:i,n.updateProfile(l,e).then(function(e){var i=e.data.fileStatus;if(""!==i.errorStatus.ErrorCount)return c.errortype(i,t.option().text),!1;c.delCats()},function(e){DevExpress.ui.notify("Server Error!","error",4e3)})})},c.delCats=function(){var i=$("#gridContainer").dxDataGrid("instance");if(0!==c.oriTagValue.length){n.setCats("+wd_FILE_CAT_DEL_VALUE=*",c.catList).then(function(e){if(""!==e.data.category.errorStatus.ErrorCount)return F.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh(),!1;c.addCats()},function(e){F.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()})}else c.addCats()},c.addCats=function(){var i=$("#gridContainer").dxDataGrid("instance");if(0!==c.tagValues.length){for(var e="",t=0;t<c.tagValues.length;t++)e=e+"+wd_FILE_CAT_ADD_VALUE["+t+"]="+c.tagValues[t].CN;n.setCats(e,c.catList).then(function(e){F.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()},function(e){F.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()})}else F.option("visible",!1),c.$parent.$parent.$parent.$parent.checked=!1,i.refresh()},c.errortype=function(e,i){var t;if(""!==e.errorStatus.wd_Error_DOCID)return t={title:e.errorStatus.wd_Error_DOCID,desc:e.errorStatus.wd_Error_DOCNAME,wdMsg:e.errorStatus.wd_Error_MSG,status:"failed",type:!1,action:i},d.$broadcast("setDialogStatus",t),F.option("visible",!1),!1;t={wdMsg:e.errorStatus.wd_Error_MSG,status:"failed",type:!0,action:i},d.$broadcast("setDialogStatus",t),F.option("visible",!1)},c.searchFt=function(){1<c.autoSearch.length&&(c.fieldListData="",c.fieldTableSpin=!1,o(function(){c.listTable(!1,!0)},1e3))},c.filterLabelTable=function(){c.showTableLoader=!1,o(function(){c.showTableLoader=!0},1e3)},c.wdEdit=!0,c.updateProfile={bindingOptions:{text:"profileBtn"},type:"success",useSubmitBehavior:!0,template:function(e,i){$("<div class='button-indicator'></div><span class='dx-button-text'>"+e.text+"</span>").appendTo(i),F=i.find(".button-indicator").dxLoadIndicator({visible:!1,width:16,height:16}).dxLoadIndicator("instance")},onClick:function(e){F.option("visible",!0)}},c.getComment={Comment:""},c.scrollTables={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",height:function(){return window.innerHeight-280},useNative:!0},c.getFieldTables=function(t,e,l,d){console.log(d),c.fieldTableTitle=e,c.fieldListData.length=0,c.showTableLoader=!1,c.wdEdit=!1,o(function(){for(var e=1;e<8;e++)null==$("#field"+e).dxTextBox("instance")?m["field"+e].value="":m["field"+e].value=$("#field"+e).dxTextBox("instance").option("value");c.fieldNum=t;var i=c.pgCabinetValue.split("|")[0];n.fieldTables(i,m,c.fieldNum,c.maxcount,c.indexFr,l,c.autoSearch).then(function(e){if(c.total=e.data.root.Header.ListCount,c.listlength=e.data.root.FieldTbl.length,""!=e.data.root.Header.ErrorCount)return c.showTableLoader=!0,DevExpress.ui.notify(e.data.root.Header.wd_Error_MSG+"!","error",4e3),!1;if(c.closeList(e.data.root),d){var i=c.fieldListData.concat(e.data.root.FieldTbl);c.listlength=i.length,c.fieldListData=i}else c.fieldListData=e.data.root.FieldTbl;c.total>c.maxcount?(c.moreTables=!0,c.checkFt=!0,c.ftCount=" "+c.listlength+" of "+c.total):("1"==c.total?c.ftCount=" 1 of 1":c.ftCount=" "+c.total+" of "+c.total,c.checkFt=!1),c.fieldTableSpin=!0,c.showTableLoader=!0,c.selected=c.fieldListData[0]},function(e){c.fieldTableSpin=!0,DevExpress.ui.notify("Server Error!","error",4e3)})},1e3)},c.closeList=function(e){var i=e.Header.List_ID;if(!f.ftListId)return f.ftListId=i,!1;n.clearListfromParm(f.ftListId).then(function(e){f.ftListId=i},function(e){DevExpress.ui.notify("Fatal IIS Error!","error",4e3)})},c.loadMore={text:"Load More",type:"success",useSubmitBehavior:!1,onClick:function(){c.indexFr=+c.indexFr+(c.maxcount+1),c.getFieldTables(c.fieldNum,c.fieldTableTitle,!1,!0)}},c.setField=function(e){for(i=1;i<=7;i++)e["f"+i+"n"]&&($("#field"+i).dxTextBox("instance").option("value",e["f"+i+"n"]),c.descField["desc"+i]=e["f"+i+"d"]);c.fieldListData.length=0,c.wdEdit=!0},c.getToolTip=function(e){var t="";for(i=1;i<=7;i++)e["f"+i+"n"]&&(t+=t=e["f"+i+"n"]+" - "+e["f"+i+"d"]+" | ");return t.substring(0,t.length-2)},c.commentData={bindingOptions:{formData:"getComment",readOnly:!1,showColonAfterLabel:!0,showValidationSummary:!1,colCount:1,validationGroup:"comment"},items:[{itemType:"group",items:[{colSpan:1,dataField:"Comment",editorType:"dxTextArea",editorOptions:{height:90},label:{text:"Comment:"}}]}]},c.commentBtn={text:"Add Comment",type:"success",useSubmitBehavior:!0,validationGroup:"comment"},c.tagList=n.getFileData().tags,c.$watch(function(){return n.getFileData()},function(e){c.tagList=e.tags}),c.$watch(function(){return u.getDesc()},function(e){c.descField=e}),c.setDescComm=function(e){if(void 0!==e[0].Comments&&""!==e[0].Description)return c.editFields.descComm=e[0].Description+"\r\n\r\n"+e[0].Comments,!1;c.editFields.descComm=e[0].Description},c.btnCancelProfile="Cancel",c.cancelProfilebtn={bindingOptions:{text:"btnCancelProfile"},type:"success",useSubmitBehavior:!0,onClick:function(e){c.fieldListData.length=0,c.wdEdit=!0}}}]);
>>>>>>> f87e3847757683542f66b38ce05de0356ce87e8f
