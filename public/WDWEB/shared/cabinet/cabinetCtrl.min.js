angular.module("WDWeb").controller("cabinetCtrl",["$scope","$rootScope","$route","$routeParams","$timeout","$log","$window","$localStorage","$location","wdService","homeService",function(t,o,i,e,r,a,n,c,l,s,u){var d=this;d.cabinet=[],d.cabinetTitle="",d.spinner=!0,t.textValue="",t.btnText="Select",r(function(){angular.element(document).ready(function(){for(var e=document.querySelectorAll(".cabinetSpinner"),n=0;n<e.length;n++)new fabric.Spinner(e[n])})},1e3),t.$on("closeAllPanel",function(e,n){d.showCabPanel=!1}),t.$on("cabinetCheckPanel",function(e,n){d.showCabPanel&&o.$broadcast("cabinetEvent",n)}),t.$on("cabinetEvent",function(e,n){d.showCabPanel=n.show,d.cabinetTitle=n.data.Desc,d.spinner=!1,d.filterCab="",$("#scrollCab").dxScrollView("instance").scrollTo(0),n.show&&s.cabinetData(n.pgID).then(function(e){var n=e.data.root;return""!=n.Header.ErrorCount?(DevExpress.ui.notify(n.Header.wd_Error_MSG,"error",4e3),!(d.spinner=!0)):""==n.items?(d.message="No folders found!",d.cabinet=[],!(d.spinner=!0)):(angular.forEach(n.items,function(e,n){d.message="",e.nodes=[{dummy:"node"}]}),d.cabinet=n.items,void(d.spinner=!0))},function(e){d.spinner=!0,a.error(e)})}),t.wdFilterBox={placeholder:"Filter",elementAttr:{id:"wdFilterCabinet"},onEnterKey:function(e){t.textValue=e.event.target.value},showClearButton:!0},t.wdFilterSideBtn={icon:"ms-Icon ms-Icon--Accept",onClick:function(e){var n=$("#wdFilterCabinet").dxTextBox("instance");t.textValue=n.option("value")},elementAttr:{class:"wdFilterSideBtn"}},d.closeCabinet=function(){d.showCabPanel=!1},d.setNodeId=function(e){return"cabId"+e.rn},d.setIcoId=function(e){return"wdIcoId"+e.rn},d.setSelectMenu=function(e){d.setFmSelect=e},d.getChild=function(t,e){d.setFmSelect=t,s.cabinetData(t.pr).then(function(e){var n=e.data.root;return""!=n.Header.ErrorCount?(DevExpress.ui.notify(n.Header.wd_Error_MSG,"error",4e3),angular.element("#cabId"+t.rn).css("visibility","hidden"),!1):""==n.items?(n.items=[{dummy:"node"}],angular.element("#cabId"+t.rn).css("visibility","hidden"),!1):void(t.nodes=n.items)},function(e){a.error(e)}),e.$parent.toggle()},d.showFiles=function(e,n,t){if(console.log(e),t.btnText="Go To",$(window).width()<=1024&&o.$emit("openMenuFMC",{}),null==e.nodes&&(e.nodes=[]),1<=e.nodes.length&&!n||0===e.nodes.length)return o.$broadcast("cabinetEvent",{show:!1,data:"",pgID:""}),d.goToUrl(e),$(window).width()<=1024&&o.$emit("openMenuFMC",{}),!1;r(function(){angular.element("#cabId"+e.rn).triggerHandler("click")},0)},d.showNodes=function(e){console.log(e)},d.goToUrl=function(e){var n=l.search();if(c.isOpeningDocPanel=!1,n.query!==e.pr)return l.path("/home").search({query:e.pr}),!1;i.reload()},t.scrollCab={scrollByContent:!0,scrollByThumb:!0,showScrollbar:"always",useNative:!0,height:function(){return window.innerHeight-190}},t.setHeight=function(){return window.innerHeight-190}}]).directive("cabMenu",function(o,e){return{templateUrl:"./WDWEB/shared/cabinet/cabinetMenu.html",link:function(e,n,t){o.on("click",function(e){n!==e.target&&n[0].contains(e.target)})}}}).directive("getSibling",function(){return{scope:!0,link:function(e,n,t){e.clicked=function(){n.siblings("div").removeClass("clicked"),n.addClass("clicked")}}}});